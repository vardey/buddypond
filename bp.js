(function(o,p){typeof exports=="object"&&typeof module<"u"?module.exports=p():typeof define=="function"&&define.amd?define(p):(o=typeof globalThis<"u"?globalThis:o||self,o.BP=p())})(this,function(){"use strict";const o={};typeof window<"u"&&(window.bp=o),o.version="6.7.0",o.log=console.log,o.log=function(){},o.error=console.error,o.reportError=function(){},o.mode="dev",(window.location.href.includes("buddypond")||window.location.href.includes("?prod=true"))&&(o.mode="prod"),o.config={host:""};const p=window.location.origin,l={host:"https://buddypond.com",api:"https://buddypond.com/api/buddylist",cdn:"https://files.buddypond.com",admin:"https://buddypond.com/api/admin",apiKeys:"https://buddypond.com/api/api-keys",apps:"https://buddypond.com/api/apps",coin:"https://buddypond.com/api/coin",gamblor:"https://gamblor.buddypond.com/api/v6",imageSearch:"https://buddypond.com/api/image-search",portfolio:"https://buddypond.com/api/portfolio",orderbook:"https://buddypond.com/api/orderbook",messagesApi:"https://buddypond.com/api/messages",uploads:"https://buddypond.com/api/uploads",errors:"https://buddypond.com/api/errors",randolph:"https://buddypond.com/api/randolph",buddyProxy:"https://buddypond.com/api/proxy",buddylistWs:"wss://buddypond.com/api/buddylist/ws/buddylist",chessWs:"wss://buddypond.com/api/chess/ws/chess",messagesWs:"wss://buddypond.com/api/messages/ws/messages",pondsWs:"wss://buddypond.com/api/messages/ws/ponds",tweetsWs:"wss://tweets.buddypond.com/api/tweets/ws/tweets",videoChat:"wss://videochat.buddypond.com/api/videochat/ws"},u={host:p,admin:`${p}:8789/api/admin`,api:`${p}:8787/api/buddylist`,apps:`${p}:9008/api/apps`,apiKeys:`${p}:9009/api/api-keys`,buddyProxy:`${p}:9007/api/proxy`,coin:`${p}:9001/api/coin`,errors:`${p}:9010/api/errors`,gamblor:`${p}:9012/api/gamblor`,imageSearch:`${p}:9005/api/image-search`,messagesApi:`${p}:8788/api/messages`,portfolio:`${p}:9002/api/portfolio`,randolph:`${p}:8889/api/randolph`,uploads:`${p}:9004/api/uploads`,videoChat:"wss://192.168.200.59:8001/videochat/ws",buddylistWs:`${p.replace("http://","ws://")}:8787/api/buddylist/ws/buddylist`,chessWs:`${p.replace("http://","ws://")}:5556/api/chess/ws/chess`,messagesWs:`${p.replace("http://","ws://")}:8788/api/messages/ws/messages`,pondsWs:`${p.replace("http://","ws://")}:8788/api/messages/ws/ponds`,tweetsWs:`${p.replace("http://","ws://")}:9020/api/tweets/ws/tweets`};function f(e="prod"){return e==="prod"?l:u}function h(e){console.log("assignBuddyPondEndpoints",e),buddypond.host=e.host,buddypond.endpoint=e.api,buddypond.messagesWsEndpoint=e.messagesWs,buddypond.pondsWsEndpoint=e.pondsWs,buddypond.tweetsWsEndpoint=e.tweetsWs,buddypond.messagesApiEndpoint=e.messagesApi,buddypond.buddylistWsEndpoint=e.buddylistWs,buddypond.adminEndpoint=e.admin,buddypond.errorsEndpoint=e.errors,buddypond.uploadsEndpoint=e.uploads,buddypond.portfolioEndpoint=e.portfolio,buddypond.coinEndpoint=e.coin,buddypond.randolphEndpoint=e.randolph,buddypond.imageSearchEndpoint=e.imageSearch,buddypond.buddyProxy=e.buddyProxy,buddypond.appsEndpoint=e.apps,buddypond.apiKeysEndpoint=e.apiKeys,buddypond.chessWsEndpoint=e.chessWs,buddypond.gamblorEndpoint=e.gamblor,buddypond.videoChatEndpoint=e.videoChat}return o.apps={},o.data={},o.settings={},o._modules={},o.vendor={},o._cache={},o._cache.css={},o._cache.html={},o._cache.js={},o.setConfig=function(t,s=!1){s?o.config={...o.config,...t}:o.config=t},o.init=async function(t={}){typeof t.host>"u"&&(t.host="https://buddypond.com"),o.config.host=t.host,await o.appendScript("/v5/apps/based/client/lib/api.js",!1,!0);let s=f(t.env);console.log(s),h(s),o.setConfig(s),o.config.host=t.host,await o.appendScript("/desktop/assets/js/jquery.min.js"),await o.appendCSS(o.config.host+"/desktop/assets/css/desktop.css",!1,!0),await o.start(["ui","client","localstorage","themes","buddyscript"]),await o.load("apps"),await o.appendScript(o.config.host+"/v5/vendor/flexHide.js"),await o.appendScript(o.config.host+"/desktop/assets/js/jquery-ui.min.js"),await o.appendCSS(o.config.host+"/desktop/assets/css/jquery-ui.min.css",!1,!0)},o.start=async function(t=[]){for(let s of t)await o.importModule(s)},o.open=async function(t,s={context:"default"}){let i=t;if(typeof t=="string"){if(this.apps.list&&this.apps.list){let n=this.apps.list;for(let d in n){let a=this.apps.list[d];if(a&&a.alias&&Array.isArray(a.alias)&&a.alias.includes(i)){i=d;break}}}try{await o.importModule(i,{},!0)}catch(n){console.log("Failed to load app:",i,n)}}if(typeof t=="object"&&(i=t.name,s=t,await o.importModule(i,s,!0)),o.apps[i]&&typeof o.apps[i].open=="function"){let n=await o.apps[i].open(s);return n&&typeof n.focus=="function"&&n.focus(),n}},o.close=async function(t){o.apps[t]&&typeof o.apps[t].close=="function"&&await o.apps[t].close()},o.load=async function(t,s={}){if(typeof t=="string"){if(t.endsWith(".css"))return o.appendCSS(t);if(t.endsWith(".html"))return o.fetchHTMLFragment(t);if(t.endsWith(".js"))return o.appendScript(t);if(t.endsWith(".json"))return o.fetchJSON(t);if(!t.includes("."))return o.importModule(t,s)}console.log("Cannot load unknown resource type",t)},o.importModule=async function(t,s,i=!0,n){let d=o.config.host+`/v5/apps/based/${t}/${t}.js`,a=t;if(typeof t=="object"&&(s=t,a=t.name,t=a),o.mode==="prod"?d.includes("/card/cards")?(d=o.config.host+`/v5/dist/apps/based/${t}`,d=d.replace("apps/based/v5","")):d=o.config.host+`/v5/dist/apps/based/${t}.js`:d=o.config.host+`/v5/apps/based/${t}/${t}.js`,window.discordMode&&(d=o.config.host+`/.proxy/v5/apps/based/${t}/${t}.js`),i||(d=o.config.host+t),d+="?v="+o.version,console.log("importModule modulePath",d,t,s,i),o._modules[d])return o._modules[d];i&&o.emit("bp::loading",a);try{let r=await import(d);return i&&(o.apps[a]=new r.default(o,s),typeof o.apps[a].init=="function"?(await o.apps[a].init(s),o.log("init complete",a)):o.log("no init function found",a),n&&(o.emit("bp::loaded",a,r),n(o.apps[a]))),o._modules[d]=r,r}catch(r){o.error("Failed to load module:",a,r),delete o.apps[a]}},o.fetchHTMLFragment=async function(t){let s=`${t}`;return window.discordMode&&(s=`/.proxy/${t}`),s=o.config.host+s,s+="?v="+o.version,console.log("fetchHTMLFragment",s),o._cache.html[s]||(o._cache.html[s]=await fetch(s).then(i=>i.text())),o._cache.html[s]},o.fetchJSON=async function(t){return fetch(t).then(s=>s.json())},o.appendCSS=async function(t,s=!1,i=!1){let n=t;if(!t.startsWith("http")&&!t.startsWith("blob:"))if(o.mode==="prod"&&i!==!0){const a=t.replace(/^\.\//,"").replace(/\.css$/,"");let r=a;if(a.includes("/card/"))r=`${a}`;else{const c=a.lastIndexOf("/");c!==-1&&(r=a.substring(0,c))}r=r.replace("/v5",""),n=`${o.config.host}/v5/dist/${r}.css`}else n=`${o.config.host}${t}`;if(n+="?v="+o.version,o._cache.css[n]&&!s)return"cached";o._cache.css[n]=new Date().getTime();let d=document.createElement("link");return d.rel="stylesheet",d.href=n,new Promise((a,r)=>{d.onload=()=>{a("loaded")},d.onerror=()=>{r(new Error(`Failed to load CSS from ${n}`))},document.head.appendChild(d)})},o.appendScript=async function(t){let s=t;!t.includes("http")&&!t.includes("blob")&&(s=`${o.config.host}${t}`);let i=document.createElement("script");return i.src=s,console.log("appendScript",s),document.head.appendChild(i),new Promise((n,d)=>{i.onload=n,i.onerror=d})},o.createWorker=async function(t,s={}){let i=`${o.config.host}/v5${t}`;o.log("createWorker",i);try{const d=await(await fetch(i)).blob(),a=URL.createObjectURL(d);let r=s||{};const c=new Worker(a,r);return o.log("Local Worker created from:",t),c}catch(n){return console.error("Failed to load worker script:",t,n),null}},o._emitters={},o.emit=function(t,...s){o.log("emit",t,...s),o._emitters[t]&&o._emitters[t].forEach(i=>{i.callback&&i.callback(...s)})},o.on=function(t,s,i){if(!t||!s||!i)throw new Error("Missing required parameters for on(). Try: bp.on(event, label, callback). All Event Emitter require a label");o._emitters[t]||(o._emitters[t]=[]),o._emitters[t].push({label:s,callback:i}),o.log("on",t,s)},o.off=function(t,s){o.log("off",t,s),o._emitters[t]&&(o._emitters[t]=o._emitters[t].filter(i=>i.label!==s))},o.set=function(t,s){const i=t.split(".");let n=o.settings,d="";i.slice(0,-1).forEach((r,c)=>{d+=(c>0?".":"")+r,n[r]||(n[r]={}),n=n[r],o.emit(`settings::${d}`,n)});const a=i[i.length-1];d+=(d?".":"")+a,n[a]=s,o.emit("settings",t,s),o.emit(`settings::${d}`,s)},o.get=function(t){const s=t.split(".");let i=o.settings;for(const n of s){if(i[n]===void 0)return;i=i[n]}return i},o.play=async function(){await o.importModule("play"),o.play.call(this,...arguments)},o.focus=function(){},o.isMobile=function(){return window.innerWidth<=767&&("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)},o.me="Guest",o});
