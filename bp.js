(function(t,p){typeof exports=="object"&&typeof module<"u"?module.exports=p():typeof define=="function"&&define.amd?define(p):(t=typeof globalThis<"u"?globalThis:t||self,t.BP=p())})(this,function(){"use strict";const t={};typeof window<"u"&&(window.bp=t),t.version="7.1.2",t.log=console.log,t.log=function(){},t.error=console.error,t.reportError=function(){},t.mode="dev",(window.location.href.includes("buddypond")||window.location.href.includes("?prod=true"))&&(t.mode="prod"),t.config={host:""};const p=window.location.origin,l={host:"https://buddypond.com",api:"https://buddypond.com/api/buddylist",cdn:"https://files.buddypond.com",admin:"https://buddypond.com/api/admin",apiKeys:"https://buddypond.com/api/api-keys",apps:"https://buddypond.com/api/apps",coin:"https://buddypond.com/api/coin",gamblor:"https://gamblor.buddypond.com/api/v6",imageSearch:"https://buddypond.com/api/image-search",portfolio:"https://buddypond.com/api/portfolio",orderbook:"https://buddypond.com/api/orderbook",messagesApi:"https://buddypond.com/api/messages",uploads:"https://buddypond.com/api/uploads",errors:"https://buddypond.com/api/errors",randolph:"https://buddypond.com/api/randolph",buddyProxy:"https://buddypond.com/api/proxy",buddylistWs:"wss://buddypond.com/api/buddylist/ws/buddylist",chessWs:"wss://buddypond.com/api/chess/ws/chess",messagesWs:"wss://buddypond.com/api/messages/ws/messages",pondsWs:"wss://buddypond.com/api/messages/ws/ponds",tweetsWs:"wss://tweets.buddypond.com/api/tweets/ws/tweets",videoChat:"wss://videochat.buddypond.com/api/videochat/ws"},u={host:p,admin:`${p}:8789/api/admin`,api:`${p}:8787/api/buddylist`,apps:`${p}:9008/api/apps`,apiKeys:`${p}:9009/api/api-keys`,buddyProxy:`${p}:9007/api/proxy`,coin:`${p}:9001/api/coin`,errors:`${p}:9010/api/errors`,gamblor:`${p}:9012/api/gamblor`,imageSearch:`${p}:9005/api/image-search`,messagesApi:`${p}:8788/api/messages`,portfolio:`${p}:9002/api/portfolio`,randolph:`${p}:8889/api/randolph`,uploads:`${p}:9004/api/uploads`,videoChat:"wss://192.168.200.59:8001/videochat/ws",buddylistWs:`${p.replace("http://","ws://")}:8787/api/buddylist/ws/buddylist`,chessWs:`${p.replace("http://","ws://")}:5556/api/chess/ws/chess`,messagesWs:`${p.replace("http://","ws://")}:8788/api/messages/ws/messages`,pondsWs:`${p.replace("http://","ws://")}:8788/api/messages/ws/ponds`,tweetsWs:`${p.replace("http://","ws://")}:9020/api/tweets/ws/tweets`};function f(s="prod"){return s==="prod"?l:u}function h(s){console.log("assignBuddyPondEndpoints",s),buddypond.host=s.host,buddypond.endpoint=s.api,buddypond.messagesWsEndpoint=s.messagesWs,buddypond.pondsWsEndpoint=s.pondsWs,buddypond.tweetsWsEndpoint=s.tweetsWs,buddypond.messagesApiEndpoint=s.messagesApi,buddypond.buddylistWsEndpoint=s.buddylistWs,buddypond.adminEndpoint=s.admin,buddypond.errorsEndpoint=s.errors,buddypond.uploadsEndpoint=s.uploads,buddypond.portfolioEndpoint=s.portfolio,buddypond.coinEndpoint=s.coin,buddypond.randolphEndpoint=s.randolph,buddypond.imageSearchEndpoint=s.imageSearch,buddypond.buddyProxy=s.buddyProxy,buddypond.appsEndpoint=s.apps,buddypond.apiKeysEndpoint=s.apiKeys,buddypond.chessWsEndpoint=s.chessWs,buddypond.gamblorEndpoint=s.gamblor,buddypond.videoChatEndpoint=s.videoChat}return t.apps={},t.data={},t.settings={},t._modules={},t.vendor={},t._cache={},t._cache.css={},t._cache.html={},t._cache.js={},t.setConfig=function(o,e=!1){e?t.config={...t.config,...o}:t.config=o},t.init=async function(o={}){typeof o.host>"u"&&(o.host="https://buddypond.com"),t.config.host=o.host,await t.appendScript("/v5/apps/based/client/lib/api.js",!1,!0);let e=f(o.env);console.log(e),h(e),t.setConfig(e),t.config.host=o.host,await t.appendScript("/desktop/assets/js/jquery.min.js"),await t.appendCSS(t.config.host+"/desktop/assets/css/desktop.css",!1,!0),await t.start(["ui","client","localstorage","themes","buddyscript"]),await t.load("apps"),await t.appendScript(t.config.host+"/v5/vendor/flexHide.js"),await t.appendScript(t.config.host+"/desktop/assets/js/jquery-ui.min.js"),await t.appendCSS(t.config.host+"/desktop/assets/css/jquery-ui.min.css",!1,!0)},t.start=async function(o=[]){for(let e of o)await t.importModule(e)},t.findApp=function(o){let e=null;if(t.apps.list){let i=t.apps.list;for(let n in i){let d=t.apps.list[n];if(n===o){e=n;break}if(d&&d.alias&&Array.isArray(d.alias)&&d.alias.includes(o)){e=n;break}}}return e},t.open=async function(o,e={context:"default"}){let i=o;if(typeof o=="string"){let n=t.findApp(i);n&&(i=n);try{await t.importModule(i,{},!0)}catch(d){console.log("Failed to load app:",i,d)}}if(typeof o=="object"&&(i=o.name,e=o,await t.importModule(i,e,!0)),t.apps[i]&&typeof t.apps[i].open=="function"){let n=await t.apps[i].open(e);return n&&typeof n.focus=="function"&&n.focus(),n}},t.close=async function(o){t.apps[o]&&typeof t.apps[o].close=="function"&&await t.apps[o].close()},t.load=async function(o,e={}){if(typeof o=="string"){if(o.endsWith(".css"))return t.appendCSS(o);if(o.endsWith(".html"))return t.fetchHTMLFragment(o);if(o.endsWith(".js"))return t.appendScript(o);if(o.endsWith(".json"))return t.fetchJSON(o);if(!o.includes("."))return t.importModule(o,e)}console.log("Cannot load unknown resource type",o)},t.importModule=async function(o,e,i=!0,n){let d=t.config.host+`/v5/apps/based/${o}/${o}.js`,a=o;if(typeof o=="object"&&(e=o,a=o.name,o=a),t.mode==="prod"?d.includes("/card/cards")?(d=t.config.host+`/v5/dist/apps/based/${o}`,d=d.replace("apps/based/v5","")):d=t.config.host+`/v5/dist/apps/based/${o}.js`:d=t.config.host+`/v5/apps/based/${o}/${o}.js`,window.discordMode&&(d=t.config.host+`/.proxy/v5/apps/based/${o}/${o}.js`),i||(d=t.config.host+o),d+="?v="+t.version,t._modules[d])return t._modules[d];i&&t.emit("bp::loading",a);try{let r=await import(d);return i&&(t.apps[a]=new r.default(t,e),typeof t.apps[a].init=="function"?(await t.apps[a].init(e),t.log("init complete",a)):t.log("no init function found",a),n&&(t.emit("bp::loaded",a,r),n(t.apps[a]))),t._modules[d]=r,r}catch(r){t.error("Failed to load module:",a,r),delete t.apps[a]}},t.fetchHTMLFragment=async function(o){let e=`${o}`;return window.discordMode&&(e=`/.proxy/${o}`),e=t.config.host+e,e+="?v="+t.version,t._cache.html[e]||(t._cache.html[e]=await fetch(e).then(i=>i.text())),t._cache.html[e]},t.fetchJSON=async function(o){return fetch(o).then(e=>e.json())},t.appendCSS=async function(o,e=!1,i=!1){let n=o;if(!o.startsWith("http")&&!o.startsWith("blob:"))if(t.mode==="prod"&&i!==!0){const a=o.replace(/^\.\//,"").replace(/\.css$/,"");let r=a;if(a.includes("/card/"))r=`${a}`;else{const c=a.lastIndexOf("/");c!==-1&&(r=a.substring(0,c))}r=r.replace("/v5",""),n=`${t.config.host}/v5/dist/${r}.css`}else n=`${t.config.host}${o}`;if(n+="?v="+t.version,t._cache.css[n]&&!e)return"cached";t._cache.css[n]=new Date().getTime();let d=document.createElement("link");return d.rel="stylesheet",d.href=n,new Promise((a,r)=>{d.onload=()=>{a("loaded")},d.onerror=()=>{r(new Error(`Failed to load CSS from ${n}`))},document.head.appendChild(d)})},t.appendScript=async function(o){let e=o;if(!o.includes("http")&&!o.includes("blob")&&(e=`${t.config.host}${o}`),e+="?v="+t.version,t._cache.js[e])return"cached";t._cache.js[e]=new Date().getTime();let i=document.createElement("script");return i.src=e,document.head.appendChild(i),new Promise((n,d)=>{i.onload=n,i.onerror=d})},t.createWorker=async function(o,e={}){let i=`${t.config.host}/v5${o}`;t.log("createWorker",i);try{const d=await(await fetch(i)).blob(),a=URL.createObjectURL(d);let r=e||{};const c=new Worker(a,r);return t.log("Local Worker created from:",o),c}catch(n){return console.error("Failed to load worker script:",o,n),null}},t._emitters={},t.emit=function(o,...e){t.log("emit",o,...e),t._emitters[o]&&t._emitters[o].forEach(i=>{i.callback&&i.callback(...e)})},t.on=function(o,e,i){if(!o||!e||!i)throw new Error("Missing required parameters for on(). Try: bp.on(event, label, callback). All Event Emitter require a label");t._emitters[o]||(t._emitters[o]=[]),t._emitters[o].push({label:e,callback:i}),t.log("on",o,e)},t.off=function(o,e){t.log("off",o,e),t._emitters[o]&&(t._emitters[o]=t._emitters[o].filter(i=>i.label!==e))},t.set=function(o,e){const i=o.split(".");let n=t.settings,d="";i.slice(0,-1).forEach((r,c)=>{d+=(c>0?".":"")+r,n[r]||(n[r]={}),n=n[r],t.emit(`settings::${d}`,n)});const a=i[i.length-1];d+=(d?".":"")+a,n[a]=e,t.emit("settings",o,e),t.emit(`settings::${d}`,e)},t.get=function(o){const e=o.split(".");let i=t.settings;for(const n of e){if(i[n]===void 0)return;i=i[n]}return i},t.play=async function(){await t.importModule("play"),t.play.call(this,...arguments)},t.focus=function(){},t.isMobile=function(){return window.innerWidth<=767&&("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)},t.me="Guest",t});
