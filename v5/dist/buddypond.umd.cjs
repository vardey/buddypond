(function(e,a){typeof exports=="object"&&typeof module<"u"?module.exports=a():typeof define=="function"&&define.amd?define(a):(e=typeof globalThis<"u"?globalThis:e||self,e.BP=a())})(this,function(){"use strict";const e={};return typeof window<"u"&&(window.bp=e),e.version="6.6.7",e.log=console.log,e.log=function(){},e.error=console.error,e.reportError=function(){},e.mode="dev",(window.location.href.includes("buddypond")||window.location.href.includes("?prod=true"))&&(e.mode="prod"),e.config={host:""},e.apps={},e.data={},e.settings={},e._modules={},e.vendor={},e._cache={},e._cache.css={},e._cache.html={},e._cache.js={},e.setConfig=function(t,o=!1){o?e.config={...e.config,...t}:e.config=t},e.start=async function(t=[]){for(let o of t)await e.importModule(o)},e.open=async function(t,o={context:"default"}){let i=t;if(typeof t=="string"){if(this.apps.desktop&&this.apps.desktop.appList){let n=this.apps.desktop.appList;for(let s in n){let r=this.apps.desktop.appList[s];if(r&&r.alias&&Array.isArray(r.alias)&&r.alias.includes(i)){i=s;break}}}try{await e.importModule(i,{},!0)}catch(n){console.log("Failed to load app:",i,n)}}if(typeof t=="object"&&(i=t.name,o=t,await e.importModule(i,o,!0)),e.apps[i]&&typeof e.apps[i].open=="function"){let n=await e.apps[i].open(o);return n&&typeof n.focus=="function"&&n.focus(),n}},e.load=async function(t,o={}){if(typeof t=="string"){if(t.endsWith(".css"))return e.appendCSS(t);if(t.endsWith(".html"))return e.fetchHTMLFragment(t);if(t.endsWith(".js"))return e.appendScript(t);if(t.endsWith(".json"))return e.fetchJSON(t);if(!t.includes("."))return e.importModule(t,o)}console.log("Cannot load unknown resource type",t)},e.importModule=async function(t,o,i=!0,n){let s=e.config.host+`/v5/apps/based/${t}/${t}.js`,r=t;if(typeof t=="object"&&(o=t,r=t.name,t=r),e.mode==="prod"?s.includes("/card/cards")?(s=e.config.host+`/v5/dist/apps/based/${t}`,s=s.replace("apps/based/v5","")):s=e.config.host+`/v5/dist/apps/based/${t}.js`:s=e.config.host+`/v5/apps/based/${t}/${t}.js`,window.discordMode&&(s=e.config.host+`/.proxy/v5/apps/based/${t}/${t}.js`),i||(s=t),s+="?v="+e.version,e._modules[s])return e._modules[s];i&&e.emit("bp::loading",r);try{let c=await import(s);return i&&(e.apps[r]=new c.default(e,o),typeof e.apps[r].init=="function"?(await e.apps[r].init(o),e.log("init complete",r)):e.log("no init function found",r),n&&(e.emit("bp::loaded",r,c),n(e.apps[r]))),e._modules[s]=c,c}catch(c){e.error("Failed to load module:",r,c),delete e.apps[r]}},e.fetchHTMLFragment=async function(t){let o=`${t}`;return window.discordMode&&(o=`/.proxy/${t}`),o+="?v="+e.version,e._cache.html[o]||(e._cache.html[o]=await fetch(o).then(i=>i.text())),e._cache.html[o]},e.fetchJSON=async function(t){return fetch(t).then(o=>o.json())},e.appendCSS=async function(t,o=!1,i=!1){let n=t;if(!t.startsWith("http")&&!t.startsWith("blob:"))if(e.mode==="prod"&&i!==!0){const r=t.replace(/^\.\//,"").replace(/\.css$/,"");let c=r;if(r.includes("/card/"))c=`${r}`;else{const l=r.lastIndexOf("/");l!==-1&&(c=r.substring(0,l))}c=c.replace("/v5",""),n=`${e.config.host}/v5/dist/${c}.css`}else n=`${e.config.host}${t}`;if(n+="?v="+e.version,e._cache.css[n]&&!o)return"cached";e._cache.css[n]=new Date().getTime();let s=document.createElement("link");return s.rel="stylesheet",s.href=n,new Promise((r,c)=>{s.onload=()=>{r("loaded")},s.onerror=()=>{c(new Error(`Failed to load CSS from ${n}`))},document.head.appendChild(s)})},e.appendScript=async function(t){let o=t;!t.includes("http")&&!t.includes("blob")&&(o=`${e.config.host}${t}`);let i=document.createElement("script");return i.src=o,document.head.appendChild(i),new Promise((n,s)=>{i.onload=n,i.onerror=s})},e.createWorker=async function(t,o={}){let i=`${e.config.host}/v5${t}`;e.log("createWorker",i);try{const s=await(await fetch(i)).blob(),r=URL.createObjectURL(s);let c=o||{};const l=new Worker(r,c);return e.log("Local Worker created from:",t),l}catch(n){return console.error("Failed to load worker script:",t,n),null}},e._emitters={},e.emit=function(t,...o){e.log("emit",t,...o),e._emitters[t]&&e._emitters[t].forEach(i=>{i.callback&&i.callback(...o)})},e.on=function(t,o,i){if(!t||!o||!i)throw new Error("Missing required parameters for on(). Try: bp.on(event, label, callback). All Event Emitter require a label");e._emitters[t]||(e._emitters[t]=[]),e._emitters[t].push({label:o,callback:i}),e.log("on",t,o)},e.off=function(t,o){e.log("off",t,o),e._emitters[t]&&(e._emitters[t]=e._emitters[t].filter(i=>i.label!==o))},e.set=function(t,o){const i=t.split(".");let n=e.settings,s="";i.slice(0,-1).forEach((c,l)=>{s+=(l>0?".":"")+c,n[c]||(n[c]={}),n=n[c],e.emit(`settings::${s}`,n)});const r=i[i.length-1];s+=(s?".":"")+r,n[r]=o,e.emit("settings",t,o),e.emit(`settings::${s}`,o)},e.get=function(t){const o=t.split(".");let i=e.settings;for(const n of o){if(i[n]===void 0)return;i=i[n]}return i},e.play=async function(){await e.importModule("play"),e.play.call(this,...arguments)},e.focus=function(){},e.isMobile=function(){return window.innerWidth<=767&&("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)},e.me="Guest",e});
