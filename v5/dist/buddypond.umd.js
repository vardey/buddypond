(function(o,p){typeof exports=="object"&&typeof module<"u"?module.exports=p():typeof define=="function"&&define.amd?define(p):(o=typeof globalThis<"u"?globalThis:o||self,o.BP=p())})(this,function(){"use strict";const o={};typeof window<"u"&&(window.bp=o),o.version="6.7.0",o.log=console.log,o.log=function(){},o.error=console.error,o.reportError=function(){},o.mode="dev",(window.location.href.includes("buddypond")||window.location.href.includes("?prod=true"))&&(o.mode="prod"),o.config={host:""};const p=window.location.origin,l={host:"https://buddypond.com",api:"https://buddypond.com/api/buddylist",cdn:"https://files.buddypond.com",admin:"https://buddypond.com/api/admin",apiKeys:"https://buddypond.com/api/api-keys",apps:"https://buddypond.com/api/apps",coin:"https://buddypond.com/api/coin",gamblor:"https://gamblor.buddypond.com/api/v6",imageSearch:"https://buddypond.com/api/image-search",portfolio:"https://buddypond.com/api/portfolio",orderbook:"https://buddypond.com/api/orderbook",messagesApi:"https://buddypond.com/api/messages",uploads:"https://buddypond.com/api/uploads",errors:"https://buddypond.com/api/errors",randolph:"https://buddypond.com/api/randolph",buddyProxy:"https://buddypond.com/api/proxy",buddylistWs:"wss://buddypond.com/api/buddylist/ws/buddylist",chessWs:"wss://buddypond.com/api/chess/ws/chess",messagesWs:"wss://buddypond.com/api/messages/ws/messages",pondsWs:"wss://buddypond.com/api/messages/ws/ponds",tweetsWs:"wss://tweets.buddypond.com/api/tweets/ws/tweets",videoChat:"wss://videochat.buddypond.com/api/videochat/ws"},u={host:p,admin:`${p}:8789/api/admin`,api:`${p}:8787/api/buddylist`,apps:`${p}:9008/api/apps`,apiKeys:`${p}:9009/api/api-keys`,buddyProxy:`${p}:9007/api/proxy`,coin:`${p}:9001/api/coin`,errors:`${p}:9010/api/errors`,gamblor:`${p}:9012/api/gamblor`,imageSearch:`${p}:9005/api/image-search`,messagesApi:`${p}:8788/api/messages`,portfolio:`${p}:9002/api/portfolio`,randolph:`${p}:8889/api/randolph`,uploads:`${p}:9004/api/uploads`,videoChat:"wss://192.168.200.59:8001/videochat/ws",buddylistWs:`${p.replace("http://","ws://")}:8787/api/buddylist/ws/buddylist`,chessWs:`${p.replace("http://","ws://")}:5556/api/chess/ws/chess`,messagesWs:`${p.replace("http://","ws://")}:8788/api/messages/ws/messages`,pondsWs:`${p.replace("http://","ws://")}:8788/api/messages/ws/ponds`,tweetsWs:`${p.replace("http://","ws://")}:9020/api/tweets/ws/tweets`};function f(s="prod"){return s==="prod"?l:u}function h(s){console.log("assignBuddyPondEndpoints",s),buddypond.host=s.host,buddypond.endpoint=s.api,buddypond.messagesWsEndpoint=s.messagesWs,buddypond.pondsWsEndpoint=s.pondsWs,buddypond.tweetsWsEndpoint=s.tweetsWs,buddypond.messagesApiEndpoint=s.messagesApi,buddypond.buddylistWsEndpoint=s.buddylistWs,buddypond.adminEndpoint=s.admin,buddypond.errorsEndpoint=s.errors,buddypond.uploadsEndpoint=s.uploads,buddypond.portfolioEndpoint=s.portfolio,buddypond.coinEndpoint=s.coin,buddypond.randolphEndpoint=s.randolph,buddypond.imageSearchEndpoint=s.imageSearch,buddypond.buddyProxy=s.buddyProxy,buddypond.appsEndpoint=s.apps,buddypond.apiKeysEndpoint=s.apiKeys,buddypond.chessWsEndpoint=s.chessWs,buddypond.gamblorEndpoint=s.gamblor,buddypond.videoChatEndpoint=s.videoChat}return o.apps={},o.data={},o.settings={},o._modules={},o.vendor={},o._cache={},o._cache.css={},o._cache.html={},o._cache.js={},o.setConfig=function(t,e=!1){e?o.config={...o.config,...t}:o.config=t},o.init=async function(t={}){await o.appendScript("/v5/apps/based/client/lib/api.js");let e=f(t.env);console.log(e),h(e),o.setConfig(e),await o.appendScript("/desktop/assets/js/jquery.min.js"),await o.appendCSS("/desktop/assets/css/desktop.css",!1,!0),await o.start(["ui","client","localstorage","themes","buddyscript"]),await o.load("apps"),await o.appendScript("/v5/vendor/flexHide.js"),await o.appendScript("/desktop/assets/js/jquery-ui.min.js"),await o.appendCSS("/desktop/assets/css/jquery-ui.min.css",!1,!0)},o.start=async function(t=[]){for(let e of t)await o.importModule(e)},o.open=async function(t,e={context:"default"}){let i=t;if(typeof t=="string"){if(this.apps.list&&this.apps.list){let n=this.apps.list;for(let d in n){let a=this.apps.list[d];if(a&&a.alias&&Array.isArray(a.alias)&&a.alias.includes(i)){i=d;break}}}try{await o.importModule(i,{},!0)}catch(n){console.log("Failed to load app:",i,n)}}if(typeof t=="object"&&(i=t.name,e=t,await o.importModule(i,e,!0)),o.apps[i]&&typeof o.apps[i].open=="function"){let n=await o.apps[i].open(e);return n&&typeof n.focus=="function"&&n.focus(),n}},o.close=async function(t){o.apps[t]&&typeof o.apps[t].close=="function"&&await o.apps[t].close()},o.load=async function(t,e={}){if(typeof t=="string"){if(t.endsWith(".css"))return o.appendCSS(t);if(t.endsWith(".html"))return o.fetchHTMLFragment(t);if(t.endsWith(".js"))return o.appendScript(t);if(t.endsWith(".json"))return o.fetchJSON(t);if(!t.includes("."))return o.importModule(t,e)}console.log("Cannot load unknown resource type",t)},o.importModule=async function(t,e,i=!0,n){let d=o.config.host+`/v5/apps/based/${t}/${t}.js`,a=t;if(typeof t=="object"&&(e=t,a=t.name,t=a),o.mode==="prod"?d.includes("/card/cards")?(d=o.config.host+`/v5/dist/apps/based/${t}`,d=d.replace("apps/based/v5","")):d=o.config.host+`/v5/dist/apps/based/${t}.js`:d=o.config.host+`/v5/apps/based/${t}/${t}.js`,window.discordMode&&(d=o.config.host+`/.proxy/v5/apps/based/${t}/${t}.js`),i||(d=t),d+="?v="+o.version,o._modules[d])return o._modules[d];i&&o.emit("bp::loading",a);try{let r=await import(d);return i&&(o.apps[a]=new r.default(o,e),typeof o.apps[a].init=="function"?(await o.apps[a].init(e),o.log("init complete",a)):o.log("no init function found",a),n&&(o.emit("bp::loaded",a,r),n(o.apps[a]))),o._modules[d]=r,r}catch(r){o.error("Failed to load module:",a,r),delete o.apps[a]}},o.fetchHTMLFragment=async function(t){let e=`${t}`;return window.discordMode&&(e=`/.proxy/${t}`),e+="?v="+o.version,o._cache.html[e]||(o._cache.html[e]=await fetch(e).then(i=>i.text())),o._cache.html[e]},o.fetchJSON=async function(t){return fetch(t).then(e=>e.json())},o.appendCSS=async function(t,e=!1,i=!1){let n=t;if(console.log("appendCSS",t,o.mode,e,i),!t.startsWith("http")&&!t.startsWith("blob:"))if(o.mode==="prod"&&i!==!0){const a=t.replace(/^\.\//,"").replace(/\.css$/,"");let r=a;if(a.includes("/card/"))r=`${a}`;else{const c=a.lastIndexOf("/");c!==-1&&(r=a.substring(0,c))}r=r.replace("/v5",""),n=`${o.config.host}/v5/dist/${r}.css`}else n=`${o.config.host}${t}`;if(n+="?v="+o.version,console.log("appendCSS fullUrl",n),o._cache.css[n]&&!e)return"cached";o._cache.css[n]=new Date().getTime();let d=document.createElement("link");return d.rel="stylesheet",d.href=n,new Promise((a,r)=>{d.onload=()=>{a("loaded")},d.onerror=()=>{r(new Error(`Failed to load CSS from ${n}`))},document.head.appendChild(d)})},o.appendScript=async function(t){let e=t;!t.includes("http")&&!t.includes("blob")&&(e=`${o.config.host}${t}`);let i=document.createElement("script");return i.src=e,document.head.appendChild(i),new Promise((n,d)=>{i.onload=n,i.onerror=d})},o.createWorker=async function(t,e={}){let i=`${o.config.host}/v5${t}`;o.log("createWorker",i);try{const d=await(await fetch(i)).blob(),a=URL.createObjectURL(d);let r=e||{};const c=new Worker(a,r);return o.log("Local Worker created from:",t),c}catch(n){return console.error("Failed to load worker script:",t,n),null}},o._emitters={},o.emit=function(t,...e){o.log("emit",t,...e),o._emitters[t]&&o._emitters[t].forEach(i=>{i.callback&&i.callback(...e)})},o.on=function(t,e,i){if(!t||!e||!i)throw new Error("Missing required parameters for on(). Try: bp.on(event, label, callback). All Event Emitter require a label");o._emitters[t]||(o._emitters[t]=[]),o._emitters[t].push({label:e,callback:i}),o.log("on",t,e)},o.off=function(t,e){o.log("off",t,e),o._emitters[t]&&(o._emitters[t]=o._emitters[t].filter(i=>i.label!==e))},o.set=function(t,e){const i=t.split(".");let n=o.settings,d="";i.slice(0,-1).forEach((r,c)=>{d+=(c>0?".":"")+r,n[r]||(n[r]={}),n=n[r],o.emit(`settings::${d}`,n)});const a=i[i.length-1];d+=(d?".":"")+a,n[a]=e,o.emit("settings",t,e),o.emit(`settings::${d}`,e)},o.get=function(t){const e=t.split(".");let i=o.settings;for(const n of e){if(i[n]===void 0)return;i=i[n]}return i},o.play=async function(){await o.importModule("play"),o.play.call(this,...arguments)},o.focus=function(){},o.isMobile=function(){return window.innerWidth<=767&&("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)},o.me="Guest",o});
