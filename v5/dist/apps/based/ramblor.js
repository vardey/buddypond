let e=class{constructor(e={}){this.algo=e.algo||"default",this.history=[],this.userSeed=[],this.systemSeed=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}seed(...e){this.userSeed=e.flat().map((e=>e.toString()))}roll(e,r){if("number"!=typeof e||"number"!=typeof r)throw new Error("Min and max must be numbers");if(e>r)throw new Error("Min cannot be greater than max");this.systemSeed=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER);const t=this.userSeed.join("|")+"|"+this.systemSeed,s=this.simpleHash(t),a=e+Math.abs(s)%(r-e+1),l={generation:this.history.length+1,min:e,max:r,value:a,userSeeds:this.userSeed.slice(),systemSeed:this.systemSeed};return this.history.push(l),l}toss(){const e=this.roll(0,1);return{...e,label:1===e.value?"heads":"tails",value:e.value}}pick(e){if(!Array.isArray(e)||0===e.length)throw new Error("Pick requires a non-empty array");const r=this.roll(0,e.length-1);return{...r,item:e[r.value],index:r.value}}getHistory(e=null){if(null===e)return this.history;if(e<0){const r=this.history.length+e;return r>=0?this.history[r]:null}return this.history[e]}prove(e){if(!e||"object"!=typeof e)return!1;const r=e.userSeeds.join("|")+"|"+e.systemSeed,t=this.simpleHash(r),s=Math.abs(t),a=e.max-e.min+1;console.log("proving roll",e,"positiveValue",s,"range",a);const l=e.min+s%a;console.log("expectedResult",l,"actualResult",e.value);let o=l===e.value;return console.log("result",o),o}simpleHash(e){let r=0;for(let t=0;t<e.length;t++){r=(r<<5)-r+e.charCodeAt(t)|0}return r}};class r{constructor(r,t={}){return this.bp=r,this.options=t,this.ramblor=new e,this}async init(){return this.bp.log("Hello from Ramblor"),this.html=await this.bp.load("/v5/apps/based/ramblor/ramblor.html"),await this.bp.appendCSS("/v5/apps/based/ramblor/ramblor.css"),"loaded Ramblor"}async open(e={}){if(!this.ramblorWindow){this.ramblorWindow=this.bp.apps.ui.windowManager.createWindow({id:"ramblor",title:"Ramblor",x:50,y:100,width:400,height:460,parent:$("#desktop")[0],onClose:()=>{this.ramblorWindow=null},content:this.html,resizable:!0,minimizable:!0,maximizable:!0,closable:!0,focusable:!0,maximized:!1,minimized:!1});const e=$(this.ramblorWindow.content),r=e.find(".ramblor-verify-form"),t=e.find(".ramblor-result-text");r.on("submit",(e=>{e.preventDefault();const s={generation:parseInt(r.find("#ramblor-gen").val(),10),min:parseInt(r.find("#ramblor-min").val(),10),max:parseInt(r.find("#ramblor-max").val(),10),value:parseInt(r.find("#ramblor-value").val(),10),userSeeds:JSON.parse(r.find("#ramblor-user-seeds").val()||"[]"),systemSeed:parseInt(r.find("#ramblor-system-seed").val(),10)},a=this.ramblor.prove(s);t.text(a?"Roll is valid!":"Roll is invalid.").css("color",a?"#20C997":"#DC3545")})),r.find("input").on("input",(()=>{const e={generation:parseInt(r.find("#ramblor-gen").val(),10),min:parseInt(r.find("#ramblor-min").val(),10),max:parseInt(r.find("#ramblor-max").val(),10),value:parseInt(r.find("#ramblor-value").val(),10),userSeeds:JSON.parse(r.find("#ramblor-user-seeds").val()||"[]"),systemSeed:parseInt(r.find("#ramblor-system-seed").val(),10)};console.log("proving rollData:",e);const s=this.ramblor.prove(e);t.text(s?"Roll is valid!":"Roll is invalid.").css("color",s?"#20C997":"#DC3545")}))}const r=$(this.ramblorWindow.content);r.find(".ramblor-verify-form");const t=r.find(".ramblor-result-text");console.log("Opening Ramblor with options:",e);const s=e.roll||{};let a=new URLSearchParams(window.location.search);if(0===Object.keys(s).length&&(s.generation=parseInt(a.get("generation"),10),s.min=parseInt(a.get("min"),10),s.max=parseInt(a.get("max"),10),s.value=parseInt(a.get("value"),10),s.userSeeds=JSON.parse(a.get("userSeeds")||"[]"),s.systemSeed=parseInt(a.get("systemSeed"),10)),console.log("Roll data:",s),s.generation){r.find("#ramblor-gen").val(s.generation),r.find("#ramblor-min").val(s.min),r.find("#ramblor-max").val(s.max),r.find("#ramblor-value").val(s.value),r.find("#ramblor-user-seeds").val(JSON.stringify(s.userSeeds||[])),r.find("#ramblor-system-seed").val(s.systemSeed);const e=this.ramblor.prove(s);t.text(e?"Roll is valid!":"Roll is invalid.").css("color",e?"#20C997":"#DC3545")}return this.ramblorWindow}}export{r as default};
//# sourceMappingURL=ramblor.js.map
