{"version":3,"file":"desktop.js","sources":["../../../apps/based/desktop/lib/Folder.js","../../../apps/based/desktop/lib/shortcuts/createShortCut.js","../../../apps/based/desktop/lib/appList.js","../../../apps/based/desktop/lib/client.js","../../../apps/based/desktop/lib/defaultDesktopShortcuts.js","../../../apps/based/desktop/desktop.js","../../../apps/based/desktop/lib/File.js","../../../apps/based/desktop/lib/shortcuts/addShortCut.js","../../../apps/based/desktop/lib/addFolder.js","../../../apps/based/desktop/lib/shortcuts/removeShortCut.js","../../../apps/based/desktop/lib/shortcuts/arrangeShortCuts.js","../../../apps/based/desktop/lib/contextmenu/setupContextMenu.js","../../../apps/based/desktop/lib/contextmenu/showContextMenu.js","../../../apps/based/desktop/lib/viewSource.js","../../../apps/based/desktop/lib/shortcuts/renameShortCut.js","../../../apps/based/desktop/lib/apps/addApp.js","../../../apps/based/desktop/lib/apps/removeApp.js","../../../apps/based/desktop/lib/bindKeyboardShortcuts.js"],"sourcesContent":["export default class Folder {\n    constructor(data, options = {}) {\n        this.data = data;\n        this.parentElement = options.parentElement;\n        this.desktop = options.desktop;\n        this.depth = options.depth;\n        this.options = options;\n    }\n\n    render(app = {}) {\n    \n        app = this.data;\n        // Create the shortcut element\n        const folderDiv = document.createElement('div');\n        folderDiv.className = `folder ${app.class || ''}`;\n\n        if (this.depth > 1) {\n            folderDiv.classList.add(`hidden`);\n        }\n        folderDiv.classList.add('icon', 'shortcut');   \n        const anchor = document.createElement('a');\n        // anchor.href = app.href || `#icon_dock_${app.name}`;\n\n        const image = document.createElement('img');\n        image.className = 'bp-desktop-icon';\n        image.loading = 'lazy';\n        image.src = 'desktop/assets/images/icons/icon_folder_64.png';\n\n        const title = document.createElement('span');\n        title.className = 'title';\n        title.textContent = app.label || app.name || app.id;\n\n        anchor.appendChild(image);\n        anchor.appendChild(title);\n        folderDiv.appendChild(anchor);\n\n        // folderDiv.onclick = () => this.openFolder(); // Placeholder for folder opening logic\n\n        $(folderDiv).draggable({\n            containment: 'parent' // Confine dragging within the parent container\n        });\n\n        // folderDiv click handler\n        folderDiv.addEventListener('mousedown', (e) => {\n           this.options.onOpen();\n        });\n\n        this.parentElement.appendChild(folderDiv);\n\n        // Recursively render each child in this folder\n        // this.data.children.forEach(child => this.desktop.renderNode(child, folderDiv, this.depth + 1));\n    }\n\n    open () {\n        // Logic to open the folder\n           this.options.onOpen();\n    }\n}\n","export default function createShortcut() {\n    if (!this.createShortCutWindow) {\n        let shortCutHtml = `\n        <div class=\"bp-create-shortcut-container\">\n            <form id=\"create-shortcut-form\" action=\"#\" method=\"post\">\n                <div class=\"bp-form-group\">\n                    <label>Shortcut Type:</label>\n                    <div class=\"bp-shortcut-type\">\n                        <label><input type=\"radio\" name=\"shortcut-type\" value=\"url\" checked> URL</label>\n                        <label><input type=\"radio\" name=\"shortcut-type\" value=\"app\"> App</label>\n                        <label><input type=\"radio\" name=\"shortcut-type\" value=\"buddyscript\"> Buddyscript</label>\n                    </div>\n                </div>\n                <div class=\"bp-form-group bp-shortcut-examples\">\n                    <!-- radio group of examples -->\n                    <label>Examples:</label>\n                    <div class=\"bp-shortcut-examples-list\">\n                        <label><input type=\"radio\" name=\"shortcut-example\" value=\"url\" checked>Open a Website</label>\n                        <label><input type=\"radio\" name=\"shortcut-example\" value=\"app\">Open your own Pond</label>\n                        <label><input type=\"radio\" name=\"shortcut-example\" value=\"buddyscript\">Run a Buddyscript</label>\n                    </div>\n                </div>\n                <div class=\"bp-form-group\">\n                    <label for=\"shortcut-name\">Shortcut Name:</label>\n                    <input type=\"text\" id=\"shortcut-name\" name=\"shortcut-name\" required>\n                </div>\n                <div class=\"bp-form-group bp-app-select-group\" style=\"display: none;\">\n                    <label for=\"shortcut-apps\">Select App:</label>\n                    <select id=\"shortcut-apps\" name=\"shortcut-apps\">\n                        <option value=\"\">Select App</option>\n                        ${Object.keys(this.bp.apps.desktop.appList).map(appName => `<option value=\"${appName}\">${this.bp.apps.desktop.appList[appName].label || appName}</option>`).join('')}\n                    </select>\n                </div>\n                <div class=\"bp-form-group bp-app-select-group\">\n                    <!-- context input, type input, output input -->\n                    <label for=\"shortcut-context\">Context:</label>\n                    <input type=\"text\" id=\"shortcut-context\" name=\"shortcut-context\" placeholder=\"Optional, e.g. 'chatWindow'\" value=\"\">\n                    <label for=\"shortcut-type\">Type:</label>\n                    <input type=\"text\" id=\"shortcut-type\" name=\"shortcut-type\" placeholder=\"Optional, e.g. 'pond'\" value=\"pond\">\n                    <label for=\"shortcut-output\">Output:</label>\n                    <input type=\"text\" id=\"shortcut-output\" name=\"shortcut-output\" placeholder=\"Optional, e.g. 'chat'\" value=\"chat\">\n                </div>\n\n                <div class=\"bp-form-group bp-url-group\">\n                    <label for=\"shortcut-url\">URL:</label>\n                    <input type=\"text\" id=\"shortcut-url\" name=\"shortcut-url\" required>\n                </div>\n\n                <div class=\"bp-form-group bp-command-group\">\n                    <label for=\"shortcut-command\">Command:</label>\n                    <input type=\"text\" id=\"shortcut-command\" name=\"shortcut-command\" required>\n                </div>\n                <div class=\"bp-form-group\">\n                    <label for=\"shortcut-icon\">Icon URL:</label>\n                    <input type=\"text\" id=\"shortcut-icon\" name=\"shortcut-icon\" placeholder=\"Optional\">\n                </div>\n                <div class=\"bp-form-group\">\n                    <label for=\"shortcut-description\">Description:</label>\n                    <textarea id=\"shortcut-description\" name=\"shortcut-description\" placeholder=\"Optional\"></textarea>\n                </div>\n                <div class=\"bp-form-group bp-form-actions\">\n                    <button type=\"submit\" class=\"bp-btn bp-btn-primary bp-create-shortcut-btn\">Create Shortcut</button>\n                    <button type=\"button\" class=\"bp-btn bp-btn-secondary\" id=\"cancel-shortcut\">Cancel</button>\n                </div>\n            </form>\n        </div>`;\n\n        this.createShortCutWindow = this.bp.apps.ui.windowManager.createWindow({\n            id: 'create-shortcut',\n            title: 'Create Shortcut',\n            icon: 'desktop/assets/images/icons/icon_console_64.png',\n            x: 250,\n            y: 75,\n            width: 600,\n            height: 600,\n            minWidth: 400,\n            minHeight: 300,\n            parent: $('#desktop')[0],\n            content: shortCutHtml,\n            resizable: true,\n            minimizable: true,\n            maximizable: true,\n            closable: true,\n            focusable: true,\n            maximized: false,\n            minimized: false,\n            onClose: () => {\n                // Clean up if needed\n                this.createShortCutWindow = null; // Clear reference on close\n            }\n        });\n\n        // Toggle app dropdown visibility based on shortcut type\n        $('#create-shortcut-form input[name=\"shortcut-type\"]').on('change', (e) => {\n            const shortcutType = e.target.value;\n            const appSelectGroup = $('.bp-app-select-group');\n            const commandGroup = $('.bp-command-group');\n            const urlGroup = $('.bp-url-group');\n            if (shortcutType === 'app') {\n                appSelectGroup.show();\n                commandGroup.hide();\n                urlGroup.hide();\n                $('#shortcut-command').prop('required', false);\n                $('#shortcut-apps').prop('required', true);\n            }\n\n            if (shortcutType === 'buddyscript') {\n                appSelectGroup.hide();\n                commandGroup.show();\n                urlGroup.hide();\n                $('#shortcut-command').prop('required', true);\n                $('#shortcut-apps').prop('required', false);\n            }\n\n            if (shortcutType === 'url') {\n                urlGroup.show();\n                appSelectGroup.hide();\n                commandGroup.hide();\n                $('#shortcut-command').prop('required', false);\n                $('#shortcut-apps').prop('required', false);\n            }\n        });\n\n        $('#create-shortcut-form').on('submit', (e) => {\n            e.preventDefault();\n            return false;\n        });\n\n        $('.bp-create-shortcut-btn').on('click', async (e) => {\n            e.preventDefault();\n            const shortcutType = $('input[name=\"shortcut-type\"]:checked').val();\n            const name = $('#shortcut-name').val().trim();\n            const appName = $('#shortcut-apps').val();\n            const command = $('#shortcut-command').val().trim();\n            let icon = $('#shortcut-icon').val().trim();\n            const description = $('#shortcut-description').val().trim();\n\n            // Validation\n            if (!name) {\n                alert('Shortcut Name is required.');\n                return;\n            }\n            if (shortcutType === 'app' && !appName) {\n                alert('Please select an app.');\n                return;\n            }\n            if ((shortcutType === 'buddyscript') && !command) {\n                alert('Command is required for URL or Buddyscript shortcuts.');\n                return;\n            }\n            if (shortcutType === 'url' && !$('#shortcut-url').val().trim()) {\n                alert('URL is required for URL shortcuts.');\n                return;\n            }\n\n            let onClick = null;\n\n            if (shortcutType === 'app') {\n\n                let context = $('#shortcut-context').val().trim() || '';\n                console.log('appNameappName', appName)\n                if (!icon) {\n                    // attempt default app icon\n                    icon = this.bp.apps.desktop.appList[appName]?.icon || 'desktop/assets/images/icons/icon_default_64.png';    \n                }\n                onClick = () => {\n                    bp.open(appName, { context: context });\n                }\n            }\n\n            if (shortcutType === 'buddyscript') {\n\n\n                onClick = () => {\n                    if (command) {\n                        // Execute the Buddyscript command\n\n                        let bs = this.bp.apps.buddyscript.parseCommand(command);\n                        console.log('got back buddyscript command', bs);\n                        if (bs.pipe) {\n                        //if (now - messageTime < 10000) {\n                        // pipeable / immediate run commands should only persist for 10 seconds\n                            bs.pipe();\n                        }\n\n                    } else {\n                        alert('Please enter a valid Buddyscript command.');\n                    }\n                }\n\n            }\n\n            if (shortcutType === 'url') {\n                const url = $('#shortcut-url').val().trim();\n\n                /*\n                // going to be challeging to pull off with un-auth proxy\n                // proxy requires a valid session for security reasons\n                // fetch the .ico from url using proxy\n                let metadata = null;\n                try {\n                    metadata = await fetchProxy.call(this, url, true, true);\n                } catch (error) {\n                    console.error('Error fetching URL metadata:', error);\n                    alert('Failed to fetch URL metadata. Please check the console for details.');\n                    return;\n                }\n\n                console.log('Fetched metadata:', metadata);\n                */\n                \n                onClick = () => {\n                    if (url) {\n                        window.open(url, '_blank');\n                    } else {\n                        alert('Please enter a valid URL.');\n                    }\n                };\n            }\n\n            // Create the shortcut object\n            const shortcut = {\n                name: name,\n                label: name,\n                shortcutType: shortcutType,\n                icon: icon || 'desktop/assets/images/icons/icon_default_64.png', // Default icon if none provided\n                description: description || '',\n                target: shortcutType === 'app' ? this.bp.apps.desktop.appList[appName]?.onClick || `bp.open('${appName}')` : command,\n                onClick: onClick,\n                parameters: {\n                    icon: icon || '',\n                    description: description || ''\n                }\n            };\n\n            try {\n                saveShortCut.call(this, shortcut);\n            } catch (error) {\n                console.error('Error creating shortcut:', error);\n                alert('Failed to create shortcut. Please check the console for details.');\n            }\n            return false;\n        });\n\n        $('#cancel-shortcut').on('click', () => {\n            this.createShortCutWindow.close();\n        });\n    } else {\n        this.createShortCutWindow.focus();\n        this.createShortCutWindow.restore();\n    }\n}\n\nfunction saveShortCut(shortcut) {\n    console.log('Saving shortcut:', shortcut);\n    // Save to localStorage\n    const shortcuts = JSON.parse(localStorage.getItem('bp-shortcuts') || '{}');\n    shortcuts[shortcut.name] = {\n        label: shortcut.label,\n        shortcutType: shortcut.shortcutType,\n        target: shortcut.target,\n        icon: shortcut.icon,\n        description: shortcut.parameters.description\n    };\n    // TODO: use app API instead\n    // localStorage.setItem('bp-short', JSON.stringify(shortcuts));\n\n    // Call addShortCut to create the shortcut on the desktop\n    this.bp.apps.desktop.addShortCut({\n        name: shortcut.name,\n        label: shortcut.label,\n        icon: shortcut.icon,\n        description: shortcut.description,\n        textIcon: !shortcut.icon ? shortcut.label.charAt(0).toUpperCase() : null\n    }, {\n      onClick: shortcut.onClick,\n\n    });\n\n    this.arrangeShortcuts(2, {\n        rowWidth: 80,\n        rowHeight: 100,\n        x: 0, // TODO: we should start from the x and y position in our calculations\n        y: 0,\n        ignoreSavedPosition: false\n    });    // Close the window\n    this.createShortCutWindow.close();\n}\n\n\nasync function fetchProxy(url, parseMetadata, showError) {\n    //console.log('Fetching via proxy:', url);\n    let proxyUrl = `${buddypond.buddyProxy}/fetch-metadata?url=${encodeURIComponent(url)}`;\n    console.log('Proxy URL:', proxyUrl);\n\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), 6000); // 6 seconds\n\n    try {\n        const response = await fetch(proxyUrl, {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n            'Authorization': `Bearer ${buddypond.qtokenid}`,\n            'x-me': buddypond.me\n            },\n            signal: controller.signal\n        });\n        clearTimeout(timeoutId);\n        if (!response.ok) {\n            throw new Error(`Proxy request failed: ${response.status} ${response.statusText}`);\n        }\n        const data = await response.json();\n        //console.log('Proxy response:', data);\n        if (parseMetadata) {\n            if (data.metadata) {\n                //console.log('Parsed metadata:', data.metadata);\n                return data.metadata;\n            } else {\n                throw new Error('No metadata found in proxy response');\n            }\n        }\n    }\n    catch (error) {\n        clearTimeout(timeoutId);\n        console.error('Error fetching via proxy:', error);\n        if (showError) {\n            alert(`Error fetching URL: ${error.message}`);\n        }\n        throw error; // Re-throw the error for further handling\n    }\n    return null; // Return null if no metadata is found\n                \n}","export default {\n  \"admin\": {\n    name: 'admin',\n    icon: `desktop/assets/images/icons/icon_admin_64.png`,\n    label: 'Admin',\n    \"onClick\": \"bp.open('admin')\",\n    adminOnly: true,\n  },\n  \"profile\": {\n    \"icon\": \"desktop/assets/images/icons/icon_myprofile_64.png\",\n    \"label\": \"My Profile\",\n    \"description\": \"Manage your profile and settings\",\n    \"onClick\": \"bp.open('profile')\",\n    \"categories\": [\"social\", \"productivity\"]\n  },\n  \"buddylist\": {\n    \"icon\": \"desktop/assets/images/icons/icon_profile_64.png\",\n    \"label\": \"BuddyList\",\n    \"description\": \"View and manage your contacts\",\n    \"onClick\": \"bp.open('buddylist')\",\n    \"categories\": [\"social\", \"community\"]\n  },\n  \"pad\": {\n    \"icon\": \"desktop/assets/images/icons/icon_pad_64.png\",\n    \"label\": \"Buddy Apps\",\n    \"description\": \"Create hosted Apps for Buddy Pond\",\n    \"onClick\": \"bp.open('pad')\",\n    \"categories\": [\"productivity\", \"creative\", \"community\"],\n    \"alias\": [\"buddy-apps\"]\n  },\n  \"pond\": {\n    \"icon\": \"desktop/assets/images/icons/icon_pond_64.png\",\n    \"label\": \"Ponds\",\n    \"description\": \"Explore shared content or communities\",\n    \"onClick\": \"bp.open('pond')\",\n    \"categories\": [\"community\", \"social\"]\n  },\n  \"tweets\": {\n    \"icon\": \"desktop/assets/images/icons/icon_tweets_64.png\",\n    \"label\": \"Tweets\",\n    \"description\": \"View and post tweets\",\n    \"categories\": [\"social\", \"community\"],\n    \"author\": \"BuddyPond\",\n  },\n  \"file-explorer\": {\n    \"icon\": \"desktop/assets/images/icons/icon_file-explorer_64.png\",\n    \"label\": \"Buddy Files\",\n    \"description\": \"Browse and manage your files\",\n    \"onClick\": \"bp.open('file-explorer')\",\n    \"desktopOnly\": true,\n    \"categories\": [\"files\", \"productivity\"],\n    \"alias\": [\"buddy-files\", \"files\"]\n  },\n  \"plays-doodle-jump-extra\": {\n    \"icon\": \"desktop/assets/images/icons/icon_doodle-jump-extra_64.png\",\n    \"label\": \"Doodle Jump\",\n    \"description\": \"Play Doodle Jump Extra game\",\n    \"onClick\": \"bp.open('doodle-jump-extra')\",\n    \"categories\": [\"games\", \"entertainment\"],\n    \"author\": \"Plays.org\",\n    \"alias\": [\"doodle-jump\"],\n  },\n  \"plays-malpek\": {\n    \"icon\": \"desktop/assets/images/icons/icon_plays-malpek_64.png\",\n    \"label\": \"Malpek\",\n    \"description\": \"Play Malpek game\",\n    \"onClick\": \"bp.open('plays-malpek')\",\n    \"categories\": [\"games\", \"entertainment\"],\n    \"author\": \"Plays.org\",\n    \"alias\": [\"malpek\"],\n  },\n  \"frvr-kittenforce\": {\n    \"icon\": \"desktop/assets/images/icons/icon_kittenforce-frvr_64.png\",\n    \"label\": \"Kitten Force\",\n    \"description\": \"Play Kitten Force FRVR game\",\n    \"onClick\": \"bp.open('frvr-kittenforce')\",\n    \"categories\": [\"games\", \"entertainment\"],\n    \"author\": \"FRVR Games\",\n    \"alias\": [\"kittenforce\"]\n  },\n  \"marbleblast\": {\n    \"icon\": \"desktop/assets/images/icons/icon_marbleblast_64.png\",\n    \"label\": \"Marble Blast\",\n    \"description\": \"Play the Marble Blast game\",\n    \"onClick\": \"bp.open('marbleblast')\",\n    \"categories\": [\"games\", \"entertainment\"],\n    \"author\": \"Vanilagy\",\n    \"alias\": [\"marble-blast\"]\n  },\n  \"frvr-greed\": {\n    \"icon\": \"desktop/assets/images/icons/icon_frvr-greed_64.png\",\n    \"label\": \"Greed\",\n    \"description\": \"Play Greedy FRVR game\",\n    \"onClick\": \"bp.open('frvr-greed')\",\n    \"categories\": [\"games\", \"entertainment\"],\n    \"author\": \"FRVR Games\",\n    \"alias\": [\"greed\"]\n  },\n  'jutsu-caster': {\n    \"icon\": \"desktop/assets/images/icons/icon_jutsu_64.png\",\n    \"label\": \"Jutsu Caster\",\n    \"description\": \"Cast Jutsu spells using hand gestures\",\n    \"onClick\": \"bp.open('jutsu-caster')\",\n    \"categories\": [\"tools\", \"creative\", \"computer-vision\"],\n    \"author\": \"BuddyPond\",\n    \"alias\": [\"jutsu\"]\n  },\n  \"minipaint\": {\n    \"icon\": \"desktop/assets/images/icons/icon_minipaint_64.png\",\n    \"label\": \"miniPaint\",\n    \"author\": \"ViliusL\",\n    \"description\": \"Advanced image editor to create and edit images\",\n    \"onClick\": \"bp.open('minipaint')\",\n    \"categories\": [\"art\", \"creative\"]\n  },\n\n  \"patatap\": {\n    \"icon\": \"desktop/assets/images/icons/icon_patatap_64.png\",\n    \"label\": \"Patatap\",\n    \"description\": \"Create music and animations with touch and keyboard input\",\n    \"onClick\": \"bp.open('patatap')\",\n    \"categories\": [\"audio\", \"music\", \"creative\"],\n    \"author\": \"Jono Brandel\"\n  },\n  /*,\n  \"sequencer\": {\n    \"icon\": \"desktop/assets/images/icons/icon_sequencer_64.png\",\n    \"label\": \"Sequencer\",\n    \"description\": \"Create and edit music sequences\",\n    \"onClick\": \"bp.open('sequencer')\",\n    \"categories\": [\"audio\", \"music\", \"creative\"],\n    \"author\": \"BuddyPond\",\n  },\n  */\n\n  /*\n  \"sandspiel\": {\n    \"icon\": \"desktop/assets/images/icons/icon_sandspiel_64.png\",\n    \"label\": \"Sandspiel\",\n    \"description\": \"A creative sandbox game with sand and physics\",\n    \"onClick\": \"bp.open('sandspiel')\",\n    \"categories\": [\"games\", \"creative\"]\n  },\n  */\n  \"vision-harp\": {\n    \"icon\": \"desktop/assets/images/icons/icon_vision-harp_64.png\",\n    \"label\": \"Vision Harp\",\n    \"description\": \"Play music using hand gestures\",\n    \"onClick\": \"bp.open('vision-harp')\",\n    \"categories\": [\"audio\", \"computer-vision\", \"music\", \"creative\"],\n    \"author\": \"BuddyPond\",\n    \"alias\": [\"harp\"]\n  },\n  /*\n  \"fingerpaint\": {\n    \"icon\": \"desktop/assets/images/icons/icon_finger-paint_64.png\",\n    \"label\": \"Finger Paint\",\n    \"description\": \"Create art using hand gestures\",\n    \"onClick\": \"bp.open('fingerpaint')\",\n    \"categories\": [\"art\", \"creative\", \"computer-vision\"],\n    \"author\": \"BuddyPond\",\n    \"alias\": [\"hand-paint\", \"hand-art\"]\n  },\n  */\n  \"soundrecorder\": {\n    \"icon\": \"desktop/assets/images/icons/icon_soundrecorder_64.png\",\n    \"label\": \"Sound Recorder\",\n    \"author\": \"Isaiah Odhner\",\n    \"description\": \"Record and save audio clips\",\n    \"onClick\": \"bp.open('soundrecorder')\",\n    \"desktopOnly\": true,\n    \"categories\": [\"audio\", \"creative\"],\n    \"alias\": [\"recorder\"]\n  },\n  \"youtube\": {\n    \"icon\": \"desktop/assets/images/icons/icon_interdimensionalcable_64.png\",\n    \"label\": \"IDC Cable\",\n    \"description\": \"Watch and browse YouTube videos\",\n    \"onClick\": \"bp.open('youtube')\",\n    \"categories\": [\"entertainment\", \"media\"],\n    \"alias\": [\"idc\"]\n  },\n  \"camera\": {\n    \"icon\": \"desktop/assets/images/icons/icon_camera_64.png\",\n    \"label\": \"Camera\",\n    \"description\": \"Capture photos or videos\",\n    \"onClick\": \"bp.open('camera')\",\n    \"categories\": [\"media\", \"creative\"]\n  },\n\n  \"coin\": {\n    \"icon\": \"desktop/assets/images/icons/icon_coin_64.png\",\n    \"label\": \"Buddy Coins\",\n    \"description\": \"Manage your virtual currency\",\n    \"onClick\": \"bp.open('coin')\",\n    \"categories\": [\"finance\"]\n  },\n\n  \"fluid-simulation\": {\n    \"icon\": \"desktop/assets/images/icons/icon_fluidsimulation_64.png\",\n    \"author\": \"Pavel Dobryakov\",\n    \"label\": \"Fluid Simulation\",\n    \"description\": \"Interact with a fluid dynamics simulation\",\n    \"onClick\": \"bp.open('fluid-simulation')\",\n    \"categories\": [\"creative\", \"entertainment\"],\n    \"alias\": [\"fluids\"]\n  },\n  \"sampler\": {\n    \"icon\": \"desktop/assets/images/icons/icon_midifighter_64.png\",\n    \"label\": \"Sampler\",\n    \"description\": \"Create and mix audio samples\",\n    \"onClick\": \"bp.open('sampler')\",\n    \"categories\": [\"audio\", \"music\", \"creative\"]\n  },\n  \"audio-visual\": {\n    \"icon\": \"desktop/assets/images/icons/icon_visuals_64.png\",\n    \"author\": \"lachlanmaclean\",\n    \"label\": \"Audio Visuals\",\n    \"description\": \"Experience audio-responsive visuals\",\n    \"onClick\": \"bp.open('audio-visual')\",\n    \"categories\": [\"creative\", \"entertainment\", \"audio\"],\n    \"alias\": [\"av\"]\n  },\n  \"chalkboard\": {\n    \"icon\": \"desktop/assets/images/icons/icon_chalkboard_64.png\",\n    \"label\": \"Chalkboard\",\n    \"description\": \"Draw and write on a virtual chalkboard\",\n    \"onClick\": \"bp.open('chalkboard')\",\n    \"categories\": [\"art\", \"creative\"],\n    \"chatWindowButton\": ['buddy', 'pond'], // adds this app as a button in the chat window, array is types of windows to add it to\n    \"chatButton\": {\n      text: 'Chalkboard',\n      image: 'desktop/assets/images/icons/icon_chalkboard_64.png',\n      onclick: async (ev) => {\n        let context = ev.target.dataset.context;\n        let type = ev.target.dataset.type;\n        // Open the image search window\n        bp.open('chalkboard', {\n          output: type || 'buddy',\n          context: context,\n        });\n        return false;\n      }\n    }\n  },\n  \"piano\": {\n    \"icon\": \"desktop/assets/images/icons/icon_piano_64.png\",\n    \"label\": \"Piano\",\n    \"description\": \"Play a virtual piano keyboard\",\n    \"onClick\": \"bp.open('piano')\",\n    \"desktopOnly\": true,\n    \"categories\": [\"music\", \"creative\"]\n  },\n  \"bubblepop\": {\n    \"icon\": \"desktop/assets/images/icons/icon_bubblepop_64.png\",\n    \"label\": \"Bubble Pop\",\n    \"description\": \"Pop bubbles and enjoy the visuals\",\n    \"onClick\": \"bp.open('bubblepop')\",\n    \"categories\": [\"games\", \"entertainment\", \"computer-vision\"],\n    \"author\": \"BuddyPond\",\n    \"alias\": [\"bubblepop\"]\n  },\n\n  \"portfolio\": {\n    \"icon\": \"desktop/assets/images/icons/icon_portfolio_64.png\",\n    \"label\": \"Portfolio\",\n    \"description\": \"Track your investments and assets\",\n    \"onClick\": \"bp.open('portfolio')\",\n    \"categories\": [\"finance\"]\n  },\n  \"audio-player\": {\n    \"icon\": \"desktop/assets/images/icons/icon_audio-player_64.png\",\n    \"label\": \"Audio Player\",\n    \"description\": \"Play and manage audio files\",\n    \"onClick\": \"bp.open('audio-player')\",\n    \"categories\": [\"media\", \"audio\"]\n  },\n  \"paint\": {\n    \"icon\": \"desktop/assets/images/icons/icon_paint_64.png\",\n    \"label\": \"Paint\",\n    \"author\": \"Isaiah Odhner\",\n    \"description\": \"A Classic Retro Style Image Editor\",\n    \"onClick\": \"bp.open('paint')\",\n    \"categories\": [\"art\", \"creative\"],\n    \"chatWindowButton\": ['buddy', 'pond'] // adds this app as a button in the chat window, array is types of windows to add it to\n  },\n  \"painterro\": {\n    \"icon\": \"desktop/assets/images/icons/icon_painterro_64.png\",\n    \"label\": \"Painterro\",\n    \"author\": \"Ivan Borshchov\",\n    \"description\": \"Easy to use image editing tool\",\n    \"onClick\": \"bp.open('painterro')\",\n    \"categories\": [\"art\", \"creative\"]\n  },\n  /* FRVR Games */\n  \"frvr-basketball\": {\n    \"icon\": \"desktop/assets/images/icons/icon_basketball-frvr_64.png\",\n    \"label\": \"BasketBall\",\n    \"description\": \"Play Basketball game\",\n    \"onClick\": \"bp.open('frvr-basketball')\",\n    \"categories\": [\"games\", \"entertainment\"],\n    \"author\": \"FRVR Games\",\n    \"alias\": [\"basketball\"]\n  },\n  \"frvr-bowlingo\": {\n    \"icon\": \"desktop/assets/images/icons/icon_frvr-bowlingo_64.png\",\n    \"label\": \"Bowlingo\",\n    \"description\": \"Play Bowlingo game\",\n    \"onClick\": \"bp.open('frvr-bowlingo')\",\n    \"categories\": [\"games\", \"entertainment\"],\n    \"author\": \"FRVR Games\",\n    \"alias\": [\"bowling\"]\n  },\n  \"mantra\": {\n    \"icon\": \"desktop/assets/images/icons/icon_mantra_64.png\",\n    \"label\": \"Mantra\",\n    \"description\": \"Play the Mantra game\",\n    \"categories\": [\"games\"]\n  },\n  \"minesweeper\": {\n    \"icon\": \"desktop/assets/images/icons/icon_minesweeper_64.png\",\n    \"label\": \"Minesweeper\",\n    \"description\": \"Classic Minesweeper puzzle game\",\n    \"categories\": [\"games\"]\n  },\n  \"emulator-nes\": {\n    \"icon\": \"desktop/assets/images/icons/icon_nes_64.png\",\n    \"app\": \"emulator\",\n    \"context\": 'nes',\n    \"label\": \"NES\",\n    \"description\": \"Play Nintendo Entertainment System games\",\n    \"options\": { \"context\": \"nes\" },\n    \"categories\": [\"games\", \"emulators\"],\n    \"author\": \"LarryD\"\n  },\n  \"emulator-sega\": {\n    \"icon\": \"desktop/assets/images/icons/icon_sega_64.png\",\n    \"app\": \"emulator\",\n    \"context\": 'sega',\n    \"label\": \"Sega\",\n    \"description\": \"Play Sega console games\",\n    \"options\": { \"context\": \"sega\" },\n    \"categories\": [\"games\", \"emulators\"],\n    \"author\": \"LarryD\"\n  },\n  \"emulator-snes\": {\n    \"icon\": \"desktop/assets/images/icons/icon_snes_64.png\",\n    \"app\": \"emulator\",\n    \"context\": 'snes',\n    \"label\": \"SNES\",\n    \"description\": \"Play Super Nintendo games\",\n    \"options\": { \"context\": \"snes\" },\n    \"categories\": [\"games\", \"emulators\"],\n    \"author\": \"LarryD\"\n  },\n  \"emulator-atari2600\": {\n    \"icon\": \"desktop/assets/images/icons/icon_atari2600_64.png\",\n    \"app\": \"emulator\",\n    \"context\": 'atari2600',\n    \"label\": \"Atari 2600\",\n    \"description\": \"Play Atari 2600 games\",\n    \"options\": { \"context\": \"atari2600\" },\n    \"categories\": [\"games\", \"emulators\"],\n    \"author\": \"LarryD\"\n  },\n  \"emulator-n64\": {\n    \"icon\": \"desktop/assets/images/icons/icon_n64_64.png\",\n    \"app\": \"emulator\",\n    \"context\": 'n64',\n    \"label\": \"n64\",\n    \"description\": \"Play Nintendo 64 games\",\n    \"options\": { \"context\": \"n64\" },\n    \"categories\": [\"games\", \"emulators\"],\n    \"desktopOnly\": true,\n    \"author\": \"LarryD\"\n  },\n  \"solitaire\": {\n    \"icon\": \"desktop/assets/images/icons/icon_solitaire_64.png\",\n    \"label\": \"Solitaire\",\n    \"description\": \"Classic Solitaire card game\",\n    \"categories\": [\"games\"]\n  },\n  \"stickman\": {\n    \"icon\": \"desktop/assets/images/icons/icon_stickman_64.png\",\n    \"label\": \"Stickman\",\n    \"description\": \"Control a stickman using body poses\",\n    \"onClick\": \"bp.open('stickman')\",\n    \"categories\": [\"creative\", \"computer-vision\", \"entertainment\"],\n    \"author\": \"BuddyPond\",\n    \"alias\": [\"stickman\"]\n  },\n\n  \"spellbook\": {\n    \"icon\": \"desktop/assets/images/icons/icon_spellbook_64.png\",\n    \"label\": \"Spellbook\",\n    \"description\": \"Manage scripts or commands\",\n    \"categories\": [\"tools\", \"productivity\"]\n  },\n\n  \"globe\": {\n    \"icon\": \"desktop/assets/images/icons/icon_globe_64.png\",\n    \"label\": \"Globe\",\n    \"description\": \"Visualize global network data\",\n    \"categories\": [\"tools\"]\n  },\n  \"file-viewer\": {\n    \"icon\": \"desktop/assets/images/icons/icon_file-viewer_64.png\",\n    \"label\": \"File Viewer\",\n    \"description\": \"View files in various formats\",\n    \"onClick\": \"bp.open('file-viewer')\",\n    \"categories\": [\"files\", \"productivity\"]\n  },\n  \"hacker-typer\": {\n    \"icon\": \"desktop/assets/images/icons/icon_hacker-typer_64.png\",\n    \"label\": \"Hack Typer\",\n    \"description\": \"Simulate hacking with a typing game\",\n    \"categories\": [\"tools\", \"games\"]\n  },\n  \"hex-editor\": {\n    \"icon\": \"desktop/assets/images/icons/icon_hex-editor_64.png\",\n    \"label\": \"Hex Editor\",\n    \"description\": \"Edit files in hexadecimal format\",\n    \"categories\": [\"tools\", \"productivity\"]\n  },\n  \"maps\": {\n    \"icon\": \"desktop/assets/images/icons/icon_maps_64.png\",\n    \"label\": \"Maps\",\n    \"description\": \"Access mapping and navigation tools\",\n    \"categories\": [\"tools\"]\n  },\n \n  \"screen-recorder\": {\n    \"icon\": \"desktop/assets/images/icons/icon_screen-recorder_64.png\",\n    \"label\": \"Screen Recorder\",\n    \"description\": \"Record your screen activity\",\n    \"onClick\": \"bp.open('screen-recorder')\",\n    \"categories\": [\"tools\", \"productivity\"],\n    \"desktopOnly\": true,\n    \"author\": \"BuddyPond\"\n  },\n \n  /*\n  */\n  \"chess\": {\n    \"icon\": \"desktop/assets/images/icons/icon_chess_64.png\",\n    \"label\": \"Chess\",\n    \"description\": \"Play chess online with friends\",\n    \"onClick\": \"bp.open('chess')\",\n    \"categories\": [\"games\", \"entertainment\"],\n    \"author\": \"BuddyPond\",\n    \"chatWindowButton\": ['buddy'],\n    // adds this app as a button in the chat window, array is types of windows to add it to\n    \"chatButton\": {\n      text: 'Chalkboard',\n      image: 'desktop/assets/images/icons/icon_chess_64.png',\n      onclick: async (ev) => {\n        let context = ev.target.dataset.context;\n        let type = ev.target.dataset.type;\n        // Open the image search window\n        await bp.load('chess', {\n          output: type || 'buddy',\n          context: context,\n        });\n        bp.apps.chess.sendGameInvite(context);\n        return false;\n      }\n    }\n    // \"alias\": [\"buddy-chess\"]\n  },\n  /*\n  \"virtual-machines\": {\n    \"icon\": \"desktop/assets/images/icons/icon_virtual-machines_64.png\",\n    \"label\": \"Virtual Machines\",\n    \"description\": \"Run virtual machines in the cloud\",\n    \"onClick\": \"bp.open('virtual-machines')\",\n    \"categories\": [\"tools\", \"productivity\"],\n    \"author\": \"BuddyPond\",\n    // \"alias\": [\"vm\"]\n  },\n  */\n /*\n  \"webllm\": {\n    \"icon\": \"desktop/assets/images/icons/icon_web_llm_64.png\",\n    \"label\": \"Web LLM\",\n    \"description\": \"Interact with large language models\",\n    \"onClick\": \"bp.open('webllm')\",\n    \"categories\": [\"tools\", \"productivity\", \"ai\"],\n    \"author\": \"BuddyPond\",\n    // \"alias\": [\"llm\"]\n  },\n  */\n\n  \"aero-player\": {\n    \"icon\": \"desktop/assets/images/icons/icon_aero-player_64.png\",\n    \"label\": \"Aero Player\",\n    \"description\": \"Play music with Aero Player\",\n    \"onClick\": \"bp.open('aero-player')\",\n    \"categories\": [\"audio\", \"music\", \"entertainment\"],\n    \"author\": \"Swayam\",\n    \"authorUrl\": \"https://github.com/swayam25/Aero\",\n     adminOnly: true\n  },\n  \n  \"motd\": {\n    \"icon\": \"desktop/assets/images/icons/icon_console_64.png\",\n    \"label\": \"MOTD\",\n    \"description\": \"Message of the Day\",\n    \"onClick\": \"bp.open('motd')\",\n    \"categories\": [\"social\", \"community\"],\n    \"chatWindowButton\": ['buddy', 'pond'] // adds this app as a button in the chat window, array is types of windows to add it to\n  },\n\n  /*\n  \"gamblor-coinflip\": {\n    \"icon\": \"\",\n    \"label\": \"Coin Flip\",\n    \"alias\": \"coinflip\",\n    \"onClick\": \"bp.open('gamblor-coinflip')\",\n    \"description\": \"Flip a coin and get a random result\",\n    \"categories\": [\"games\", \"entertainment\"],\n    \"author\": \"BuddyPond\",\n    \"authorUrl\": \"https://github.com/BuddyPond\",\n    \"alias\": [\"coinflip\"],\n  }\n  */\n\n}","const client = {};\n\nclient.incrementAppInstallCount = async function (appName) {\n    if (!appName) {\n        console.error('No app name provided for incrementing install count');\n        return;\n    }\n\n    // if appName is not an array, wrap it in an array\n    if (!Array.isArray(appName)) {\n        appName = [appName];\n    }\n\n    // Simulate an API call to increment the install count\n    try {\n        await fetch(`${buddypond.appsEndpoint}/apps/install`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({ appIds: appName }),\n        });\n        // console.log(`Install count for app ${appName} incremented successfully.`);\n    } catch (error) {\n        console.error(`Failed to increment install count for app ${appName}:`, error);\n    }\n}\n\nclient.getAppsStats = async function () {\n    try {\n        const response = await fetch(`${buddypond.appsEndpoint}/stats`, {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n        });\n\n        if (!response.ok) {\n            throw new Error(`HTTP error! status: ${response.status}`);\n        }\n\n        const data = await response.json();\n        return data;\n    } catch (error) {\n        console.error('Failed to fetch app stats:', error);\n        return null;\n    }\n}\n\nexport default client;","export default function defaultDesktopShortcuts() {\n\n    // check if we have default apps, if not initialize them\n    let installedApps = this.bp.settings.apps_installed || {};\n    let installedTaskBarApps = this.bp.settings.taskbar_apps || {};\n\n    // check for legacy v4 versions, may have malformed data for new UI\n    // best way to check is if all .icon fields are missing from every entry\n    let isLegacySettings = false;\n    if (Object.keys(installedApps).length > 0) {\n        // console.log('Checking for legacy settings...', installedApps);\n        isLegacySettings = Object.values(installedApps).every(app => !app.icon);\n    }\n    if (isLegacySettings) {\n        installedApps = {};\n    }\n\n    // console.log('installedTaskBarApps from settings', installedTaskBarApps)\n\n    if (Object.keys(installedTaskBarApps).length === 0) {\n\n        let defaultTaskBarApps = [\n            'file-explorer',\n            'pad',\n            'buddylist',\n            // 'pond',\n            'portfolio',\n        ];\n\n        if (this.bp.isMobile()) {\n            defaultTaskBarApps = [\n                'buddylist',\n                // 'pond',\n                'portfolio',\n                'coin',\n                //'youtube',\n                'fluid-simulation',\n            ]\n        }\n\n        defaultTaskBarApps.forEach(appName => {\n            let app = this.bp.apps.desktop.appList[appName];\n            if (app) {\n                // console.log(`Adding default taskbar app: ${appName}`);\n                installedTaskBarApps[appName] = {\n                    app: app.app || appName,\n                    context: app.context || 'default',\n                    label: app.label || appName,\n                    icon: app.icon || ''\n                };\n            } else {\n                console.warn(`App ${appName} not found in desktop app list.`);\n            }\n        });\n    }\n\n    Object.keys(installedTaskBarApps).forEach(appName => {\n        let savedApp = installedTaskBarApps[appName];\n        //console.log('Adding taskbar app', appName);\n        //console.log(this.bp.apps.desktop.appList)\n        // console.log('savedApp', appName, savedApp);\n        let app = this.bp.apps.desktop.appList[savedApp.id || appName];\n        if (!app) {\n            console.warn(`App ${appName} not found in desktop app list.`);\n            return;\n        }\n\n        app.id = appName; // ensure the app has an id for taskbar\n        app.app = app.app || appName; // ensure the app has an app property\n        // create new app object with necessary properties\n        let _app = {\n            ...app\n        }\n        if (_app) {\n            // console.log(`Adding default taskbar app: ${appName}`, _app);\n            this.bp.apps.ui.windowManager.taskBar.saveItem(_app);\n        } else {\n            console.warn(`App ${appName} not found in desktop app list.`);\n        }\n    });\n\n\n    if (Object.keys(installedApps).length === 0) {\n        let defaultAppList = [\n            'profile',\n            'buddylist',\n            'pad',\n            'pond',\n            'file-explorer',\n            'youtube',\n            'fluid-simulation',\n            'coin',\n            'portfolio',\n        ];\n\n\n        defaultAppList.forEach(appName => {\n            let app = this.bp.apps.desktop.appList[appName];\n            if (app) {\n                console.log(`Adding default app shortcut: ${appName}`);\n                // console.log(app);\n                installedApps[appName] = app;\n\n                // this.bp.apps.desktop.addShortCut(app);\n            } else {\n                console.warn(`App ${appName} not found in desktop app list.`);\n            }\n        });\n\n        this.bp.set('apps_installed', installedApps);\n\n        // update the count of installed apps\n        this.client.incrementAppInstallCount(Object.keys(installedApps));\n\n    }\n\n    // let installedApps = bp.settings.apps_installed || {};\n    if (Object.keys(installedApps).length > 0) {\n        Object.keys(installedApps).forEach(appName => {\n            let app = installedApps[appName];\n            if (app) {\n                // console.log(`Adding shortcut for installed app: ${appName}`, app);\n                bp.apps.desktop.addShortCut({\n                    name: appName,\n                    ...app\n                }, {\n                    onClick: () => {\n                        bp.open(app.app || appName, { context: app.context });\n                    }\n                });\n            }\n        });\n\n    }\n\n}","/* Desktop.js - Buddy Pond - Marak Squires - 2023 */\n\n// import Folder from '../file-explorer/Folder/Folder.js';\nimport Folder from \"./lib/Folder.js\";\nimport BPFile from \"./lib/File.js\";\n\n// shortcuts\nimport addShortCut from \"./lib/shortcuts/addShortCut.js\";\nimport addFolder from \"./lib/addFolder.js\";\nimport removeShortCut from \"./lib/shortcuts/removeShortCut.js\";\nimport createShortCut from \"./lib/shortcuts/createShortCut.js\";\nimport renameShortCut from \"./lib/shortcuts/renameShortCut.js\";\nimport arrangeShortcuts from \"./lib/shortcuts/arrangeShortCuts.js\";\n\n// apps\nimport appList from \"./lib/appList.js\";\nimport addApp from \"./lib/apps/addApp.js\";\nimport removeApp from \"./lib/apps/removeApp.js\";\n\n\n// context menu(s)\nimport setupContextMenu from \"./lib/contextmenu/setupContextMenu.js\";\nimport showContextMenu from \"./lib/contextmenu/showContextMenu.js\";\n\nimport bindKeyboardShortcuts from \"./lib/bindKeyboardShortcuts.js\";\n\n// utils\nimport buildJsTreeData from \"../file-explorer/lib/buildJsTreeData.js\";\nimport viewSource from \"./lib/viewSource.js\";\n\nimport client from './lib/client.js'; // client api for desktop\n\n// default data\nimport defaultDesktopShortcuts from \"./lib/defaultDesktopShortcuts.js\";\n\nexport default class Desktop {\n    constructor(bp, options = {}) {\n        this.bp = bp;\n        this.options = options;\n\n        this.apps = {}; // registered apps\n\n        this.folders = [];\n\n        // Setup containers for the desktop and shortcuts\n        this.container = document.createElement('div');\n        this.container.id = 'desktop-container';\n        this.container.className = 'desktop-container';\n\n        this.shortCutsContainer = document.createElement('div');\n        this.shortCutsContainer.id = 'desktop-shortcuts-container';\n        this.shortCutsContainer.className = 'desktop-shortcuts-container';\n        this.container.appendChild(this.shortCutsContainer);\n\n        // Set parent container\n        this.parent = options.parent || document.body;\n        this.parent.appendChild(this.container);\n\n        this.enableShortcutDragging = true;\n\n        this.enabledChatWindowButtons = [];\n\n        if (typeof options.enableShortcutDragging === 'boolean') {\n            this.enableShortcutDragging = options.enableShortcutDragging;\n        }\n\n        // Context menu for desktop\n        this.setupContextMenu();\n    }\n\n    async init() {\n        await this.bp.load('/v5/apps/based/desktop/desktop.css');\n\n        // Used for parsing shortcuts, not needed ( for now )\n        //let yaml = await this.bp.importModule('/v5/apps/based/ui/vendor/js-yaml.min.js', {}, false);\n        //this.yaml = yaml.jsYamlDefault;\n\n        // Render the default shortcuts\n        defaultDesktopShortcuts.call(this);\n        // this.bindKeyboardShortcuts();\n\n        /*\n        if (this.bp.settings.wallpaper_url) {\n            // won't work unless desktop is already loaded\n            this.bp.apps.desktop.setWallpaper(this.bp.settings.wallpaper_url);\n        } else {\n            this.bp.apps.wallpaper.wallpaperManager.active = this.bp.settings.wallpaper_name || 'solid';\n            this.bp.apps.wallpaper.wallpaperManager.start();\n        }\n        */\n\n        // check if there is a wallpaper_url\n        /*\n        if (this.bp.settings.wallpaper_url) {\n            this.setWallpaper(this.bp.settings.wallpaper_url);\n        }\n        */\n\n        // console.log('this.bp.settings.active_theme', this.bp.settings.active_theme)\n        /*\n        if (this.bp.settings.active_theme) {\n            // alert(this.bp.settings.active_theme);\n            this.bp.apps.themes.applyTheme(this.bp.settings.active_theme);\n        }\n        */\n\n        //alert(`BroadcastChannel message received: ${event.data}`);\n\n        $(window).on('resize', function () {\n            //bp.apps.desktop.showDesktopIcons();\n            //bp.apps.desktop.arrangeShortcuts();\n            arrangeDesktop();\n            console.log('Window resized, rearranging desktop shortcuts');\n        });\n\n\n        // if (this.bp.settings.wallpaper) {\n\n        // TODO: after launch, port legacy wallpaper app\n        // this.setupWallpaper(); // Set initial wallpaper\n        return 'loaded desktop';\n    }\n\n    async load() {\n        return;\n        // get file list from cdn\n        // returns cloudFiles.files ( a flat array of relative file and directory paths )\n        let cloudFiles = await this.bp.apps.client.api.listFiles('desktop', 6);\n\n        // converts the flat array of files and directories into a nested jsTree data structure\n        // this conforms to the jsTree data format\n        /*\n\n        // Expected format of the node (there are no required fields)\n            {\n            id          : \"string\" // will be autogenerated if omitted\n            text        : \"string\" // node text\n            icon        : \"string\" // string for custom\n            state       : {\n                opened    : boolean  // is the node open\n                disabled  : boolean  // is the node disabled\n                selected  : boolean  // is the node selected\n            },\n            children    : []  // array of strings or objects\n            li_attr     : {}  // attributes for the generated LI node\n            a_attr      : {}  // attributes for the generated A node\n            }\n        */\n\n        // TODO: which will be easier to write a renderer for? flat array or tree data?\n        // We believe tree data will be easier to write a renderer for\n        let treeData = buildJsTreeData(this.bp.me, cloudFiles.files);\n        console.log('treeData', treeData);\n\n        // example shortcut format\n        let yamlStr = `\n                type: Shortcut\n                target: /path/to/application.exe\n                parameters:\n                startIn: /path/to/\n                args: \"--example-arg\"\n                icon: /path/to/icon.png\n                hotkey: Ctrl+Alt+A\n                description: \"A shortcut to an application\"\n        `;\n        // load the yaml as json\n        let doc = this.yaml.load(yamlStr);\n        console.log(doc);\n\n        // we now have treeData which is the form of a jsTree data structure\n        let userRoot = treeData[0]; // the top node is the buddyname / user root / foldername on CDN\n        console.log('userRoot', userRoot) // the desktop folder itself ( since we query for it )\n        let desktopRoot = userRoot.children[0]; // the desktop folder itself ( since we query for it )\n\n        // the problem is now we intended to render the \"Desktop\" folder contents at the top-level\n        // ( such that all its children are visible on the desktop )\n        // however; with the current structure we see a \"desktop\" folder on the desktop\n        // TODO: we need a way to render the co ntents of a folder at a top-level\n        // or change the way folders are rendered\n        // render the userRoot\n        this.renderNode(desktopRoot, this.shortCutsContainer, 0, true);\n        // arrangeDesktop(); // global ( for now remove later )\n\n        return;\n\n\n\n    }\n\n    renderNode(node, parentElement, depth = 0, skipFolderUI = false) {\n        console.log('renderNode', node, parentElement, depth, skipFolderUI);\n        if (node.children && node.children.length > 0) {\n            // Check if we should skip rendering the folder UI (used for top-level folder)\n            if (skipFolderUI) {\n                // Directly render the children in the parent element\n                node.children.forEach(child => this.renderNode(child, parentElement, depth + 1));\n            } else {\n                // It's a folder and should be rendered as such\n                const folder = new Folder(node, parentElement, this, depth);\n                folder.render();\n            }\n        } else {\n            // It's a file or shortcut\n            if (node.text.endsWith('.yml')) {\n                const shortcut = new Shortcut(node, parentElement);\n                shortcut.render();\n            } else {\n                const file = new File(node, parentElement, this, depth);\n                file.render();\n            }\n        }\n    }\n\n    toggleMute() {\n        if (this.bp.settings.audio_enabled === false) {\n            this.bp.set('audio_enabled', true);\n            $('.volumeFull').show();\n            $('.volumeMuted').hide();\n            this.bp.play('desktop/assets/audio/VOLUME-ON.mp3', { tryHard: Infinity });\n        } else {\n            this.bp.set('audio_enabled', false);\n            $('.volumeFull').hide();\n            $('.volumeMuted').show();\n        }\n    }\n\n    openFolder(folderId) {\n        console.log('openFolder', folderId);\n        // Find the folder by ID\n        const folder = this.folders.find(f => f.data.name === folderId);\n        if (folder) {\n            // Open the folder (this could be a method in the Folder class)\n            folder.open();\n        } else {\n            console.error(`Folder with ID ${folderId} not found.`);\n        }\n    }\n\n}\n\nDesktop.prototype.Folder = Folder;\nDesktop.prototype.File = BPFile;\nDesktop.prototype.addShortCut = addShortCut;\nDesktop.prototype.addFolder = addFolder;\nDesktop.prototype.removeShortCut = removeShortCut;\nDesktop.prototype.arrangeShortcuts = arrangeShortcuts;\nDesktop.prototype.setupContextMenu = setupContextMenu;\nDesktop.prototype.showContextMenu = showContextMenu;\n// Desktop.prototype.buildJsTreeData = buildJsTreeData;\nDesktop.prototype.viewSource = viewSource;\n\nDesktop.prototype.showDesktopIcons = function showDesktopIcons() {\n    this.shortCutsContainer.style.display = 'flex';\n    if (this.bp.isMobile()) {\n        this.shortCutsContainer.style.position = 'absolute';\n        this.shortCutsContainer.style.left = '0px';\n        this.shortCutsContainer.style.bottom = '0px';\n    }\n}\n\nclass Shortcut {\n    constructor(data, parentElement) {\n        this.data = data;\n        this.parentElement = parentElement;\n    }\n\n    render() {\n        const shortcutElement = document.createElement('div');\n        shortcutElement.textContent = this.data.text || this.data.id;\n        shortcutElement.className = 'shortcut';\n\n        shortcutElement.classList.add('icon', 'shortcut', 'bp-desktop-iconp');\n\n        this.parentElement.appendChild(shortcutElement);\n    }\n}\n\nDesktop.prototype.appList = appList;\nDesktop.prototype.createShortCut = createShortCut;\nDesktop.prototype.renameShortCut = renameShortCut;\nDesktop.prototype.addApp = addApp;\nDesktop.prototype.removeApp = removeApp;\nDesktop.prototype.client = client; // client api for desktop\nDesktop.prototype.bindKeyboardShortcuts = bindKeyboardShortcuts;\n\nconst DelayedPushState = (() => {\n  let timeout = null;\n  let latestState = null;\n\n  function mergeUrlParams(existingUrl, newUrl) {\n    try {\n      // Parse URLs\n      const existing = new URL(existingUrl, window.location.origin);\n      const updated = new URL(newUrl, window.location.origin);\n\n      // Merge search parameters\n      const params = new URLSearchParams(existing.search);\n      for (const [key, value] of new URLSearchParams(updated.search)) {\n        params.set(key, value);\n      }\n\n      // Construct the final URL\n      return `${updated.pathname}${params.toString() ? '?' + params.toString() : ''}${updated.hash}`;\n    } catch (e) {\n      console.error('Error merging URL params:', e);\n      return newUrl; // Fallback to newUrl if parsing fails\n    }\n  }\n\n  function push(stateObj, title, url, delay = 250) {\n    // Merge existing URL parameters with new ones\n    const mergedUrl = mergeUrlParams(window.location.href, url);\n\n    // Store the latest call\n    latestState = { stateObj, title, url: mergedUrl };\n\n    // Clear any existing timer\n    if (timeout) {\n      clearTimeout(timeout);\n    }\n\n    // Set a new timer\n    timeout = setTimeout(() => {\n      const { stateObj, title, url } = latestState;\n      history.pushState(stateObj, title, url);\n      timeout = null;\n    }, delay);\n  }\n\n  return { push };\n})();\n\n\nfunction arrangeDesktop() {\n    if (!bp.apps.desktop || !bp.apps.ui) {\n        console.log('bp.apps', bp.apps)\n        console.error('Desktop app or UI is not loaded yet, cannot arrange shortcuts.');\n        return;\n        // throw new Error('Desktop app or UI is not loaded yet, cannot arrange shortcuts.');\n    }\n    if (bp.isMobile()) {\n        // $('.desktop-only').hide();\n        bp.apps.desktop.arrangeShortcuts(4, {\n            rowWidth: 256,\n            rowHeight: 256,\n            ignoreSavedPosition: false\n        });\n        bp.apps.desktop.showDesktopIcons();\n        // bp.apps.ui.windowManager.arrangeVerticalStacked()\n\n    } else {\n        bp.apps.desktop.arrangeShortcuts(2, {\n            rowWidth: 80,\n            rowHeight: 100,\n            x: 0, // TODO: we should start from the x and y position in our calculations\n            y: 0,\n            ignoreSavedPosition: false\n        }); // Arrange the icons in a grid of 4 columns\n        // bp.apps.ui.windowManager.restoreWindows();\n    }\n\n    setTimeout(() => {\n        bp.apps.desktop.showDesktopIcons();\n    }, 300);\n\n}\n\nwindow.arrangeDesktop = arrangeDesktop;\n\nwindow.DelayedPushState = DelayedPushState;","\n\nexport default class File {\n    constructor(data, parentElement, desktop, depth) {\n        this.data = data;\n        console.log(\"FIKLE DATA\", data);\n        this.parentElement = parentElement;\n        this.desktop = desktop;\n        this.options = {};\n        this.depth = depth;\n    }\n\n    render(app = {}) {\n\n        app = this.data;\n\n        // Create the shortcut element\n        const el = document.createElement('div');\n        el.className = `icon shortcut ${app.class || ''}`;\n\n        if (this.depth > 1) {\n            el.classList.add(`hidden`);\n        }\n\n        el.classList.add('icon', 'shortcut');   \n\n\n        const anchor = document.createElement('a');\n        // anchor.href = app.href || `#icon_dock_${app.name}`;\n\n        const image = document.createElement('img');\n        image.className = 'bp-desktop-icon';\n        image.loading = 'lazy';\n        image.src = app.icon;\n\n        const title = document.createElement('span');\n        title.className = 'title';\n        title.textContent = app.label || app.name || app.id;\n\n        anchor.appendChild(image);\n        anchor.appendChild(title);\n        el.appendChild(anchor);\n\n        // Adding onClick event to the .icon container\n        el.addEventListener('click', this.options.onClick);\n\n\n\n\n        // Apply jQuery UI draggable if enabled\n        if (this.enableShortcutDragging) {\n            $(el).draggable({\n                containment: 'parent' // Confine dragging within the parent container\n            });\n        }\n\n\n        this.parentElement.appendChild(el);\n\n\n        // Recursively render each child in this folder\n    }\n}\n","export default function addShortCut(app, options = {}, parent) {\n    // Default onClick behavior if not provided\n    if (typeof options.onClick !== 'function') {\n        options.onClick = () => console.log('desktop app - Missing options.onClick function', app.name);\n    }\n\n    // console.log('Adding shortcut for app:', app, 'with options:', options);\n\n    // Create the shortcut element\n    const el = document.createElement('div');\n    el.className = `icon shortcut ${app.class || ''} bp-desktop-shortcut`;\n    el.setAttribute('data-app', app.name);\n    const anchor = document.createElement('a');\n    // anchor.href = app.href || `#${app.name}`;\n\n    if (!app.textIcon) {\n        const image = document.createElement('img');\n        image.className = 'bp-desktop-icon';\n        image.loading = 'lazy';\n        image.src = app.icon;\n        if (options.imageStyle) {\n            Object.keys(options.imageStyle).forEach(key => {\n                image.style[key] = options.imageStyle[key];\n            });\n        }\n        anchor.appendChild(image);\n    } else {\n        const image = document.createElement('div');\n        image.textContent = app.textIcon;\n        image.style.fontSize = '32px';\n        image.style.position = 'relative';\n        image.style.bottom = '10px';\n        if (options.imageStyle) {\n            Object.keys(options.imageStyle).forEach(key => {\n                image.style[key] = options.imageStyle[key];\n            });\n        }\n        anchor.appendChild(image);\n    }\n\n    const title = document.createElement('span');\n    title.className = 'title';\n    title.textContent = app.label || app.name;\n    anchor.appendChild(title);\n    el.appendChild(anchor);\n\n    // Adding onClick event to the .icon container\n    // TODO: make this event only happen on touchend\n    // the idea here is that if the element was dragged, we don't want to trigger the click event\n    // but if it was tapped, we do want to trigger the click event \n    /*\n    el.addEventListener('click', (e) => {\n        alert()\n        e.preventDefault();\n        options.onClick(e, app);\n        return false;\n    });\n    */\n\n    let pointerDownPos = null;\n    let wasDragging = false;\n\n    el.addEventListener('pointerdown', (e) => {\n        pointerDownPos = { x: e.clientX, y: e.clientY };\n        wasDragging = false;\n    });\n\n    el.addEventListener('pointermove', (e) => {\n        if (!pointerDownPos) return;\n\n        const dx = e.clientX - pointerDownPos.x;\n        const dy = e.clientY - pointerDownPos.y;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n\n        // If moved more than a threshold, consider it a drag\n        if (distance > 5) {\n            wasDragging = true;\n        }\n    });\n\n    el.addEventListener('pointerup', (e) => {\n        if (!wasDragging) {\n            e.preventDefault(); // Prevent default anchor behavior\n            options.onClick(e, app);\n        }\n\n        pointerDownPos = null;\n        wasDragging = false;\n\n        // update the x/y position of the app shortcut inside this.bp.settings.installed_apps\n        let appsInstalled = this.bp.settings.apps_installed || {};\n        appsInstalled[app.name] = appsInstalled[app.name] || app;\n\n        appsInstalled[app.name].position = {\n            x: el.offsetLeft,\n            y: el.offsetTop\n        }\n\n        this.bp.set('apps_installed', appsInstalled);\n\n        return false;\n\n    });\n\n    // remove all existing context menus to avoid duplicates\n    /*\n    const existingMenus = document.querySelectorAll('.desktop-context-menu');\n    existingMenus.forEach(menu => {\n        menu.remove();\n    });\n    */\n\n    // Context menu setup\n    const contextMenu = document.createElement('div');\n    contextMenu.className = 'desktop-context-menu';\n\n    let menuHTML = ``;\n\n    // don't allow pads / buddyapps to be deleted\n    if (app.name !== 'pad') {\n         menuHTML += `<div class=\"bp-context-menu-item\" data-action=\"delete\">Delete Shortcut</div>`;\n    }\n\n    menuHTML += `\n        <div class=\"bp-context-menu-item\" data-action=\"rename\">Rename Shortcut</div>\n        <div class=\"bp-context-menu-item\" data-action=\"add-taskbar\">Add to Taskbar</div>\n    `;\n\n    contextMenu.innerHTML = menuHTML;\n    document.body.appendChild(contextMenu); // Append to body for positioning\n\n    // Hide context menu on click elsewhere\n    document.addEventListener('click', () => {\n        contextMenu.style.display = 'none';\n    });\n\n    // Prevent default context menu and show custom menu\n    el.addEventListener('contextmenu', (e) => {\n\n        const existingMenu = $('.desktop-context-menu');\n        // existingMenu.hide();\n\n        e.preventDefault();\n        // Position menu near cursor, ensuring it stays within viewport\n        const menuWidth = 150; // Approximate width of context menu\n        const menuHeight = 80; // Approximate height of context menu\n        const posX = e.clientX;\n        const posY = e.clientY;\n        const maxX = window.innerWidth - menuWidth;\n        const maxY = window.innerHeight - menuHeight;\n        contextMenu.style.left = `${Math.min(posX, maxX)}px`;\n        contextMenu.style.top = `${Math.min(posY, maxY)}px`;\n        contextMenu.style.display = 'block';\n    });\n\n    // Handle context menu actions\n    contextMenu.addEventListener('click', (e) => {\n        const action = e.target.getAttribute('data-action');\n        if (action === 'delete') {\n            this.deleteShortcut(app.name, app, options.context);\n        } else if (action === 'rename') {\n            this.renameShortCut(app.name, title, options.context);\n        } else if (action === 'add-taskbar') {\n            // Add to taskbar logic\n            app.id = app.name; // ensure the app has an id for taskbar\n            this.bp.apps.ui.windowManager.taskBar.addItem(app);\n        }\n        contextMenu.style.display = 'none';\n    });\n\n    // Append the new shortcut to the container\n    let p = parent || this.shortCutsContainer;\n    p.appendChild(el);\n\n    // Apply jQuery UI draggable if enabled\n    if (this.enableShortcutDragging) {\n        $(el).draggable({\n            containment: 'parent' // Confine dragging within the parent container\n        });\n    }\n\n    // install app into chatWindow buttons if property exists\n    if (app.chatWindowButton) {\n        let chatWindows = this.bp.apps.ui.windowManager.findWindows({\n            app: 'buddylist',\n            type: app.chatWindowButton\n        });\n        // console.log('chatWindows', chatWindows);\n\n        // these may need to be custom based on the app itself...\n        /*\n        let chatButton = {\n            text: app.label || app.name,\n            image: app.icon || 'desktop/assets/images/icons/icon_console_64.png',\n            onclick: async (ev) => {\n                let context = ev.target.dataset.context;\n                let type = ev.target.dataset.type;\n                // Open the image search window\n                bp.open(app.name, {\n                    output: type || 'buddy',\n                    context: context,\n                });\n                return false;\n            }\n        };\n        */\n\n        let chatButton = app.chatButton;\n\n        if (!chatButton) {\n            console.warn('No chatButton defined for app:', app.name);\n            return;\n        }\n        chatButton.name = app.name; // add name to button for reference\n        // adds to default chat window buttons\n        if (this.bp.apps.desktop.enabledChatWindowButtons) {\n            // console.log('Adding chat button to desktop enabledChatWindowButtons', chatButton);\n            this.bp.apps.desktop.enabledChatWindowButtons.push(chatButton);\n        }\n        if (this.bp.apps.buddylist && this.bp.apps.buddylist.options.chatWindowButtons) {\n            this.bp.apps.buddylist.options.chatWindowButtons.push(chatButton);\n        }\n\n        // adds to any open windows\n        chatWindows.forEach((chatWindow) => {\n            if (chatWindow.buttonBar) {\n                chatWindow.buttonBar.addButton(chatButton);\n            } else {\n                console.warn('No buttonBar found for pond chat window', chatWindow);\n            }\n        });\n\n    }\n\n    // Register the app with desktop.apps\n    app.options = options;\n    const appKey = options && options.context ? `${app.name}-${options.context}` : app.name;\n    this.apps[appKey] = app;\n\n    // Stubbed functions for context menu actions\n    this.deleteShortcut = function (appName, app, context) {\n        console.log(`Stub: Deleting shortcut for ${appName}${context ? `-${context}` : ''}`);\n        // Call removeApp to align with App Store logic\n        this.removeApp(appName, app);\n    };\n\n}","import Folder from './Folder.js';\nimport arrangeShortcuts from '../lib/shortcuts/arrangeShortCuts.js';\nexport default function addFolder(metadata) {\n\n    let that = this;\n\n    function renderItem(_item, parent) {\n\n        let item = {};\n        if (typeof _item === 'string') {\n            item.id = _item;\n            item.name = _item;\n            item.label = _item;\n        } else {\n            item = _item;\n        }\n\n        if (!item.icon) {\n            item.icon = `/desktop/assets/images/icons/icon_${item.id}_64.png`;\n        }\n\n        item.options = item.options || {};\n        that.addShortCut({\n            name: item.id,\n            icon: item.icon,\n            label: item.label,\n        }, {\n            onClick: () => {\n                bp.open(item.id, item.options);\n            },\n            ...item.options\n        }, parent);\n\n    }\n\n    let folderHolder = document.createElement('div');\n    folderHolder.className = 'folder-holder';\n\n    metadata.items.forEach(item => {\n        renderItem(item, folderHolder);\n    });\n\n\n    const folder = new Folder(metadata, {\n        desktop: this,\n        parentElement: this.shortCutsContainer,\n        depth: 0,\n        onOpen: () => {\n\n            this.arrangeShortcuts(4, {\n                parent: folderHolder,\n                x: 0,\n                y: 20\n            })\n\n            console.log('Folder opened:', metadata.name);\n            this.bp.apps.ui.windowManager.createWindow({\n                id: metadata.name,\n                title: metadata.name,\n                icon: '/desktop/assets/images/icons/icon_folder.png',\n                width: metadata.width || 400,\n                height: metadata.height || 150,\n                parent: $('#desktop').get(0),\n                content: folderHolder\n            });\n\n        }\n    });\n    this.folders.push(folder);\n\n    folder.render()\n    //this.addShortCut(folder);\n    // this.shortCutsContainer.appendChild(folder.render());\n}","export default function removeShortCut(appName, app) {\n    console.log(`Removing shortcut for app: ${appName}`, app);\n    // Find and remove a shortcut based on the app name\n    const shortcuts = Array.from(this.shortCutsContainer.children);\n    const shortcut = shortcuts.find(el => $(el).data('app') === appName);\n    if (shortcut) {\n        this.shortCutsContainer.removeChild(shortcut);\n    }\n\n    // TODO: add config option when removing to either target desktop or chatWindowButtons, or both\n    // deleting a shortcut from the desktop should not remove it from chat windows\n    // deleting a shortcut from chat windows should not remove it from the desktop\n    // uninstalling from appstore should remove it from both\n    if (app.chatWindowButton) {\n        // removes the shortcut from chat windows\n        if (this.bp.apps.desktop.enabledChatWindowButtons) {\n            // iterate the enabledChatWindowButtons and remove any entries where app.label matches button.text\n            this.bp.apps.desktop.enabledChatWindowButtons = this.bp.apps.desktop.enabledChatWindowButtons.filter(button => button.text !== app.label);\n            //this.bp.apps.desktop.enabledChatWindowButtons.push(chatButton);\n        }\n        // removes the shortcut from buddylist chat windows\n        if (this.bp.apps.buddylist.options.chatWindowButtons) {\n            // iterate the chatWindowButtons and remove any entries where app.label matches button.text\n            this.bp.apps.buddylist.options.chatWindowButtons = this.bp.apps.buddylist.options.chatWindowButtons.filter(button => button.text !== app.label);\n            //this.bp.apps.buddylist.options.chatWindowButtons.push(chatButton);\n        }\n\n        let chatWindows = this.bp.apps.ui.windowManager.findWindows({\n            app: 'buddylist',\n            type: app.chatWindowButton\n        });\n\n        // removes from open windows\n        chatWindows.forEach((chatWindow) => {\n            if (chatWindow.buttonBar) {\n                chatWindow.buttonBar.removeButton(app.label);\n            } else {\n                console.warn('No buttonBar found for pond chat window', chatWindow);\n            }\n        });\n    }\n\n\n}","export default function arrangeShortcuts(cols = 2, options = {\n    rowWidth: 80,\n    rowHeight: 100,\n    x: 0,\n    y: 0,\n    ignoreSavedPosition: true\n}) {\n    let parent = options.parent || this.shortCutsContainer;\n\n    if (typeof options.rowWidth !== 'number') {\n        options.rowWidth = this.bp.isMobile() ? 256 : 74;\n    }\n\n    if (typeof options.rowHeight !== 'number') {\n        options.rowHeight = this.bp.isMobile() ? 256 : 100;\n    }\n\n    if (typeof options.x !== 'number') options.x = 0;\n    if (typeof options.y !== 'number') options.y = 0;\n\n    if (window.discordView) {\n        // start from the top left corner + the width of the sidebar\n        options.x = 75;\n    }\n\n    const containerHeight = parent.offsetHeight || 600;\n    // continerHeight might not yet be defined if the desktop is not visible\n    // alert(`Container height: ${containerHeight}`);\n    const maxRows = Math.floor(containerHeight / options.rowHeight);\n\n    let appsInstalled = this.bp.settings.apps_installed || {};\n    \n    let col = 0;\n    let row = 0;\n\n    Array.from(parent.children).forEach((icon, index) => {\n        const appName = icon.getAttribute('data-app');\n        const app = appsInstalled[appName] || {};\n\n        // Respect saved position if allowed\n        // console.log('Arranging shortcut:', options);\n        /* Removes saved shortcut positions ( for now )\n        if (app.position && !options.ignoreSavedPosition) {\n            console.log('using saved position for', appName, app.position);\n            icon.style.left = `${app.position.x}px`;\n            icon.style.top = `${app.position.y}px`;\n            return;\n        }\n        */\n\n        // Calculate position\n        let x = options.x + col * options.rowWidth + 15;\n        let y = options.y + row * options.rowHeight + (this.bp.isMobile() ? 100 : 0);\n\n        // Move to next column if exceeds height\n        if (y + options.rowHeight > containerHeight) {\n            col++;\n            row = 0;\n            x = options.x + col * options.rowWidth + 15;\n            y = options.y + row * options.rowHeight + (this.bp.isMobile() ? 100 : 0);\n        }\n\n        // Save back position\n        appsInstalled[appName] = appsInstalled[appName] || {};\n        appsInstalled[appName].position = { x, y };\n        // console.log('saving position for', appName, appsInstalled[appName].position);\n\n        // Apply styles\n        icon.style.position = 'absolute';\n        icon.style.left = `${x}px`;\n        icon.style.top = `${y}px`;\n\n        row++; // advance row counter\n    });\n\n    this.bp.set('apps_installed', appsInstalled);\n}\n","// TODO: implement context menu options for desktop itself\nexport default function setupContextMenu() {\n    this.container.oncontextmenu = (event) => {\n        // check if target has class \"bp-desktop-icon\"\n        if (event.target.classList.contains('bp-desktop-icon')) {\n            // If it does, prevent the default context menu\n            return;\n        }\n\n        // find any existing context menu and remove it\n        const existingMenu = $('.desktop-context-menu');\n        existingMenu.hide();\n\n        event.preventDefault();\n        this.showContextMenu(event.clientX, event.clientY);\n    };\n}","export default function  showContextMenu(x, y) {\n\n    const menu = document.createElement('div');\n    menu.className = 'desktop-context-menu';\n    menu.style.top = `${y}px`;\n    menu.style.left = `${x}px`;\n    menu.style.display = 'block';\n    // z-index is needed to display the menu on top of other elements\n    menu.style.zIndex = '9999';\n    menu.innerHTML = `\n        <ul>\n            <!-- <li onclick=\"bp.apps.desktop.createShortCut()\">New Shortcut...</li> -->\n            <li onclick=\"bp.apps.desktop.arrangeShortcuts(2, {\n    rowWidth: 80,\n    rowHeight: 100,\n    x: 0,\n    y: 0,\n    ignoreSavedPosition: true\n            })\">Arrange Icons</li>\n            <li onclick=\"bp.open('profile', { context: 'themes' })\">Desktop Settings</li>\n            <li onclick=\"bp.apps.wallpaper.removeWallpaper()\">Remove Wallpaper</li>\n            <li onclick=\"bp.apps.desktop.viewSource()\">View Source</li>\n        </ul>\n    `;\n    // clear the body before appending the menu\n    document.body.appendChild(menu);\n    // Hide menu on click anywhere\n    document.addEventListener('click', () => menu.remove(), { once: true });\n}","export default async function viewSource (url = 'https://raw.githubusercontent.com/Marak/buddypond/refs/heads/master/index.html') {\n    // fetch the content as text\n    const response = await fetch(url);\n    const content = await response.text();\n    let win = await this.bp.open('editor-monaco', {\n        content: content\n    });\n    console.log('viewSource', win);\n    win.maximize();\n}","export default function renameShortCut(appName, titleElement) {\n    \n    const newName = prompt('Enter new shortcut name:', titleElement.textContent);\n\n    if (!newName || newName.trim() === '') {\n        // console.warn('Renaming cancelled or invalid name provided.');\n        return;\n    }\n\n    // TODO: forbidden Note check goes here ( no bad names in shortcuts )\n    let shortcut = $(`.bp-desktop-shortcut[data-app=\"${appName}\"]`);\n    console.log(`Renaming shortcut ${shortcut} to ${newName}`);\n    console.log(`Shortcut element:`, shortcut);\n\n    /*\n    // Update the shortcut name\n    shortcut.name = newName;\n    \n    // Update the label if it exists\n    if (shortcut.label) {\n        shortcut.label = newName;\n    }\n        */\n    \n    //let titleElement = shortcut.find('.title');\n    // Update the title element's text content\n    titleElement.textContent = newName;\n\n    let installed_apps = this.bp.get('apps_installed') || {};\n    // Update the app label in the installed apps\n    if (installed_apps[appName]) {\n        installed_apps[appName].label = newName;\n        this.bp.set('apps_installed', installed_apps);\n    } else {\n        console.warn(`App ${appName} not found in installed apps.`);\n    }\n\n    // Update the icon's title text\n    /*\n    const iconElement = document.querySelector(`.bp-desktop-shortcut[data-app=\"${shortcut.name}\"] .title`);\n    if (iconElement) {\n        iconElement.textContent = newName;\n    } else {\n        console.warn(`Shortcut element for ${shortcut.name} not found.`);\n    }\n    */\n    \n    // Optionally, you can also update the app settings or any other related data\n    //this.bp.set(`apps_installed.${shortcut.name}`, shortcut);\n    \n    // Play a sound effect for renaming\n    //this.bp.play('desktop/assets/audio/APP-RENAME.wav');\n    \n    // Optionally, you can rearrange shortcuts if needed\n    // this.bp.apps.desktop.arrangeShortcuts();\n    \n    console.log(`Shortcut renamed to ${newName}`);\n};","let sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));\n\nexport default async function addApp(appName, app) {\n\n    if (!appName) {\n        console.error('No app name provided');\n        return;\n    }\n\n    if (!app) {\n        console.log('this.bp.apps.desktop', this.bp.apps.desktop)\n        // if no app is provided, look up the app in the appstore\n        app = this.bp.apps.desktop.appList[appName];\n    }\n\n    if (!app) {\n        console.error(`App ${appName} not found in appstore`);\n        return;\n    }\n\n    // perform a fire-and-forget operation to increment the app install count\n    this.client.incrementAppInstallCount(appName);\n\n    // update the local app count immediately\n    // find element with data-app attribute matching appName\n    this.bp.apps.pad.data.appStats[appName] = this.bp.apps.pad.data.appStats[appName] || {};\n    this.bp.apps.pad.data.appStats[appName].installCount = (this.bp.apps.pad.data.appStats[appName]?.installCount || 0) + 1;\n\n    // console.log(`Stub: Adding app ${app} to desktop`);\n    this.bp.play('desktop/assets/audio/APP-ADD.wav', { tryHard: 1 });\n    let installedApps = this.bp.settings.apps_installed || {};\n    // TODO: lookup actual app object from appstore.apps\n    installedApps[appName] = app;\n    this.bp.set('apps_installed', installedApps);\n    this.bp.apps.desktop.addShortCut({\n        name: appName,\n        ...app\n        //icon: app.icon,\n        //label: app.label || appName,\n    }, {\n        onClick: () => {\n            // console.log(`Opening app: ${appName}`, app);\n            this.bp.open(app.app || appName, { context: app.context });\n        }\n    });\n    // this.bp.apps.desktop.hideLoadingProgressIndicator();\n    this.bp.apps.desktop.arrangeShortcuts();\n    await sleep(777); // Simulate delay for UI update\n}\n","let sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));\n\nexport default async function removeApp(appName, app) {\n\n    this.bp.play('desktop/assets/audio/APP-REMOVE.wav');\n\n    let installedApps = this.bp.settings.apps_installed || {};\n    delete installedApps[appName];\n    this.bp.set('apps_installed', installedApps);\n    //desktop.ui.renderDesktopShortCuts();\n\n    // alert('removing ' + appName);\n    this.bp.apps.desktop.removeShortCut(appName, app);\n\n    // desktop.ui.hideLoadingProgressIndicator();\n    this.bp.apps.desktop.arrangeShortcuts();\n    await sleep(777); // Simulate delay for UI update\n\n}","export default function bindKeyboardShortcuts () {\n\n    // add global keypress listener to document\n    document.addEventListener('keydown', (event) => {\n        // if key is 192 and shift is pressed, open the console\n        // check for the ` key\n        if (event.which === 192) {\n            // prevent default action\n            event.preventDefault();\n            // open the console\n            this.bp.open('console');\n            return false;\n        }\n    });\n};"],"names":["Folder","constructor","data","options","this","parentElement","desktop","depth","render","app","folderDiv","document","createElement","className","class","classList","add","anchor","image","loading","src","title","textContent","label","name","id","appendChild","$","draggable","containment","addEventListener","e","onOpen","open","saveShortCut","shortcut","console","log","JSON","parse","localStorage","getItem","shortcutType","target","icon","description","parameters","bp","apps","addShortCut","textIcon","charAt","toUpperCase","onClick","arrangeShortcuts","rowWidth","rowHeight","x","y","ignoreSavedPosition","createShortCutWindow","close","appList","admin","adminOnly","profile","categories","buddylist","pad","alias","pond","tweets","author","desktopOnly","marbleblast","minipaint","patatap","soundrecorder","youtube","camera","coin","sampler","chalkboard","chatWindowButton","chatButton","text","onclick","async","ev","context","dataset","type","output","piano","bubblepop","portfolio","paint","painterro","mantra","minesweeper","solitaire","stickman","spellbook","globe","maps","chess","load","sendGameInvite","authorUrl","motd","client","defaultDesktopShortcuts","installedApps","settings","apps_installed","installedTaskBarApps","taskbar_apps","isLegacySettings","Object","keys","length","values","every","defaultTaskBarApps","isMobile","forEach","appName","warn","savedApp","_app","ui","windowManager","taskBar","saveItem","set","incrementAppInstallCount","Array","isArray","fetch","buddypond","appsEndpoint","method","headers","body","stringify","appIds","error","getAppsStats","response","ok","Error","status","json","Desktop","folders","container","shortCutsContainer","parent","enableShortcutDragging","enabledChatWindowButtons","setupContextMenu","init","call","window","on","arrangeDesktop","renderNode","node","skipFolderUI","children","child","endsWith","Shortcut","File","toggleMute","audio_enabled","show","hide","play","tryHard","Infinity","openFolder","folderId","folder","find","f","prototype","el","setAttribute","style","fontSize","position","bottom","imageStyle","key","pointerDownPos","wasDragging","clientX","clientY","dx","dy","Math","sqrt","preventDefault","appsInstalled","offsetLeft","offsetTop","contextMenu","menuHTML","innerHTML","display","posX","posY","maxX","innerWidth","maxY","innerHeight","left","min","top","action","getAttribute","deleteShortcut","renameShortCut","addItem","chatWindows","findWindows","push","chatWindowButtons","chatWindow","buttonBar","addButton","appKey","removeApp","addFolder","metadata","that","folderHolder","items","item","_item","renderItem","createWindow","width","height","get","content","removeShortCut","from","removeChild","filter","button","removeButton","cols","discordView","containerHeight","offsetHeight","floor","col","row","index","oncontextmenu","event","contains","showContextMenu","menu","zIndex","remove","once","viewSource","url","win","maximize","showDesktopIcons","shortcutElement","createShortCut","focus","restore","shortCutHtml","map","join","minWidth","minHeight","resizable","minimizable","maximizable","closable","focusable","maximized","minimized","onClose","value","appSelectGroup","commandGroup","urlGroup","prop","val","trim","command","alert","bs","buddyscript","parseCommand","pipe","titleElement","newName","prompt","installed_apps","addApp","appStats","installCount","ms","Promise","resolve","setTimeout","bindKeyboardShortcuts","which","DelayedPushState","timeout","latestState","stateObj","delay","mergedUrl","existingUrl","newUrl","existing","URL","location","origin","updated","params","URLSearchParams","search","pathname","toString","hash","mergeUrlParams","href","clearTimeout","history","pushState"],"mappings":"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"}