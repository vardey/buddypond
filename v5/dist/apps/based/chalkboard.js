class e{constructor(e,t={}){return this.bp=e,this.options=t,this}async init(){return"loaded Chalkbord"}async open(e={}){return this.output=e.output,this.context=e.context,this.chalkWindow||(this.chalkWindow=this.bp.window(this.window(e)),this.broadcastChannel()),this.chalkWindow}broadcastChannel(){this.receiver=new BroadcastChannel("buddypond-chalkboard"),this.bc=new BroadcastChannel("buddypond-desktop"),this.bc.onmessage=async e=>{if(e.data.app,"chalkboard"===e.data.app&&"save"===e.data.action){let t=e.data.image,a=e.data.fileName||buddypond.generateSafeFilename("png"),o=`paints/${a}`;function n(e,t,a){return fetch(e).then((function(e){return e.arrayBuffer()})).then((function(e){return new File([e],t,{type:a})}))}n(t,a,"image/png").then((async e=>{if(e.filePath=o,console.log("File created:",e,e instanceof File),document.createElement("img"),!this.context||!this.output){console.warn("No context or output specified, saving file locally.");let t=document.createElement("a");return t.href=URL.createObjectURL(e),t.download=a,document.body.appendChild(t),t.click(),void document.body.removeChild(t)}let t=e=>{console.log(`Upload progress: ${e}%`)};try{let a=await buddypond.uploadFile(e,t);console.log("Upload successful:",a);let o={to:this.context,from:bp.me,type:this.output,text:a};console.log("sending multimedia message",o),bp.emit("buddy::sendMessage",o),this.close()}catch(e){console.error("Upload failed:",e)}}))}}}window(e={}){return{id:"chalkboard",title:"Chalkboard",icon:"desktop/assets/images/icons/icon_chalkboard_64.png",x:250,y:75,width:600,height:400,minWidth:400,minHeight:300,parent:$("#desktop")[0],iframeContent:"/v5/apps/based/chalkboard/vendor/chalkboard.html",resizable:!0,minimizable:!0,maximizable:!0,closable:!0,focusable:!0,maximized:!1,minimized:!1,onLoad:()=>{this.receiver.postMessage({type:"app",app:"chalkboard",action:"load",src:e.src||null})},onClose:()=>{this.chalkWindow=null,this.bc.close()}}}close(){this.chalkWindow&&this.chalkWindow.close&&this.chalkWindow.close(),this.chalkWindow=null,this.bc&&this.bc.close(),this.bc=null}}export{e as default};
//# sourceMappingURL=chalkboard.js.map
