{"version":3,"file":"emoji-picker.js","sources":["../../../apps/based/emoji-picker/emoji-picker.js"],"sourcesContent":["\nexport default class EmojiPickerClass {\n  constructor(bp) {\n    this.bp = bp;\n  }\n\n  async init() {\n    await this.bp.appendScript('/v5/apps/based/buddylist/vendor/emoji.min.js');\n    await this.bp.appendScript('/v5/apps/based/emoji-picker/vendor/grapheme-splitter.min.js')\n    this.jQueryPlugin();\n    return 'loaded emoji picker';\n  }\njQueryPlugin() {\n  // singleton DOM\n  let $picker = null;\n  let $currentTrigger = null;\n  let docHandlerAttached = false;\n\n  const DEFAULTS = {\n    autoShow: true,\n    onSelect: (emoji) => {},\n    categories: ['people','nature','food','activity','travel','objects','symbols','flags'],\n    emojiData: EMOJIS,\n  };\n\n  function buildEmojiList(data) {\n    return Object.entries(data || {}).map(([emoji, keywords]) => ({\n      emoji,\n      keywords,\n      name: keywords[0] || '',\n      search: (keywords.join(' ') + ' ' + emoji).toLowerCase()\n    }));\n  }\n\n  function renderPicker(settings, filter = '') {\n    if (!$picker) return;\n    const $grid = $picker.find('.emoji-grid');\n    const q = (filter || $picker.find('.emoji-search').val() || '').toLowerCase();\n    $grid.empty();\n\n    const emojiList = buildEmojiList(settings.emojiData);\n    const results = emojiList.filter(e => e.search.includes(q)).slice(0, 200);\n\n    results.forEach(e => {\n      const $item = $(`<button class=\"emoji-btn\" type=\"button\" style=\"border:none;background:none;cursor:pointer;padding:2px;\">${e.emoji}</button>`);\n      $item.attr('title', e.name || e.keywords.join(', '));\n      $item.on('click', () => {\n        settings.onSelect(e.emoji);\n        $picker.hide();\n        $currentTrigger = null;\n      });\n      $grid.append($item);\n    });\n  }\n\n  function createPicker() {\n    $picker = $(`\n      <div class=\"emoji-picker-popup\" style=\"position:absolute;z-index:9999;display:none;width:260px;border:1px solid #ccc;border-radius:6px;box-shadow:0 2px 10px rgba(0,0,0,0.15);background:var(--desktop_element-background);\">\n        <input type=\"text\" class=\"emoji-search\" placeholder=\"Search...\" style=\"width:100%;padding:6px;border:none;border-bottom:1px solid #eee;box-sizing:border-box;\" />\n        <div class=\"emoji-grid\" style=\"max-height:200px;min-height:200px;overflow-y:auto;padding:6px;display:flex;flex-wrap:wrap;align-items:start;gap:6px;font-size:20px;\"></div>\n      </div>\n    `);\n\n    $picker.on('click', ev => ev.stopPropagation());\n    $picker.find('.emoji-search').on('input', () => {\n      if ($currentTrigger) {\n        const settings = $currentTrigger.data('emojiPicker-settings');\n        renderPicker(settings);\n      }\n    });\n\n    $('body').append($picker);\n\n    if (!docHandlerAttached) {\n      $(document).off('click.emojiPickerGlobal').on('click.emojiPickerGlobal', e => {\n        if (!$picker) return;\n        if (!$(e.target).closest('.emoji-picker-popup').length &&\n            !($currentTrigger && ($currentTrigger.is(e.target) || $.contains($currentTrigger[0], e.target)))) {\n          $picker.hide();\n          $currentTrigger = null;\n        }\n      });\n      docHandlerAttached = true;\n    }\n\n    return $picker;\n  }\n\n  function showPicker($trigger) {\n    const settings = $trigger.data('emojiPicker-settings');\n    if (!$picker) createPicker();\n\n    if ($currentTrigger && $currentTrigger[0] === $trigger[0]) {\n      if ($picker.is(':visible')) {\n        $picker.hide();\n        $currentTrigger = null;\n        return;\n      }\n    }\n\n    $currentTrigger = $trigger;\n\n    $picker.css({ left: -9999, top: -9999, display: 'block' });\n    renderPicker(settings);\n\n    const offset = $trigger.offset();\n    const triggerHeight = $trigger.outerHeight();\n    const pickerHeight = $picker.outerHeight();\n\n    const left = offset.left;\n    const top = offset.top - pickerHeight - 8;\n\n    $picker.css({\n      left,\n      top: top < 0 ? (offset.top + triggerHeight + 8) : top,\n      display: 'block'\n    });\n\n    $picker.find('.emoji-search').focus();\n  }\n\n  $.fn.emojiPicker = function (optionsOrCommand) {\n    if (typeof optionsOrCommand === 'string') {\n      const cmd = optionsOrCommand;\n      if (cmd === 'hide') { if ($picker) $picker.hide(); $currentTrigger = null; return this; }\n      if (cmd === 'destroy') { if ($picker) { $picker.remove(); $picker=null; $currentTrigger=null; $(document).off('click.emojiPickerGlobal'); docHandlerAttached=false; } return this; }\n      if (cmd === 'show' || cmd === 'toggle') {\n        return this.each(function () { showPicker($(this)); });\n      }\n      return this;\n    }\n\n    const settings = $.extend(true, {}, DEFAULTS, optionsOrCommand || {});\n\n    return this.each(function () {\n      const $trigger = $(this);\n      $trigger.data('emojiPicker-settings', settings);\n\n      $trigger.off('click.emojiPicker').on('click.emojiPicker', function (ev) {\n        ev.stopPropagation();\n        showPicker($trigger);\n      });\n\n      if (settings.autoShow) {\n        showPicker($trigger);\n      }\n    });\n  };\n}\n\n\n}"],"names":["EmojiPickerClass","constructor","bp","this","init","appendScript","jQueryPlugin","$picker","$currentTrigger","docHandlerAttached","DEFAULTS","autoShow","onSelect","emoji","categories","emojiData","EMOJIS","renderPicker","settings","filter","$grid","find","q","val","toLowerCase","empty","data","Object","entries","map","keywords","name","search","join","e","includes","slice","forEach","$item","$","attr","on","hide","append","showPicker","$trigger","ev","stopPropagation","document","off","target","closest","length","is","contains","css","left","top","display","offset","triggerHeight","outerHeight","pickerHeight","focus","fn","emojiPicker","optionsOrCommand","cmd","remove","each","extend"],"mappings":"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"}