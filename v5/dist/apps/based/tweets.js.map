{"version":3,"file":"tweets.js","sources":["../../../apps/based/tweets/lib/client.js","../../../apps/based/tweets/lib/wsclient.js","../../../apps/based/tweets/tweets.js","../../../apps/based/tweets/lib/eventBind.js","../../../apps/based/tweets/lib/render.js","../../../apps/based/tweets/lib/renderTweet.js"],"sourcesContent":["const client = {};\n\n// client.endpoint = buddypond.adminEndpoint;\nclient.endpoint = 'http://192.168.200.59:9020';\n\nclient.apiRequest = async (uri, method = 'GET', data = null) => {\n\n    const options = {\n        method: method\n    };\n\n    let headers = {\n        \"Accept\": \"application/json\",\n        \"Content-Type\": \"application/json; charset=utf-8\",\n        \"X-Me\": buddypond.me\n      };\n      if (buddypond.qtokenid) {\n        headers[\"Authorization\"] = `Bearer ${buddypond.qtokenid}`; // ‚úÖ Use Authorization header\n      }\n\n\n    if (data) {\n        options.body = JSON.stringify(data);\n    }\n\n    options.headers = headers;\n\n    let url = `${client.endpoint}${uri}`;\n    console.log('tweets client making api request', url, options);\n \n\n    try {\n        const response = await fetch(url, options);\n        if (!response.ok) {\n          console.log('rrrr', response)\n          // get text from response\n          const errorText = await response.text();\n          throw new Error(errorText || response.statusText || 'API request failed');\n            //throw new Error(response.statusText || 'API request failed');\n        }\n        return await response.json();\n    } catch (error) {\n        console.error('Error in API request:', error);\n        throw error;\n    }\n\n};\n\nexport default client;","export default class TweetsWebSocketClient {\n  constructor({ endpoint, bp }) {\n    this.endpoint = buddypond.tweetsWsEndpoint;\n    this.bp = bp;\n\n    this.ws = null;\n    this.reconnectAttempts = 0;\n    this.maxReconnectAttempts = 5;\n    this.maxBackoffDelay = 10000; // 10 seconds\n    this.isIntentionallyClosed = false;\n  }\n\n  async connect() {\n    const url = `${this.endpoint}?me=${buddypond.me}&qtokenid=${buddypond.qtokenid}`;\n    console.log(`üîå Connecting to Tweets...`);\n\n    return new Promise((resolve, reject) => {\n      const ws = new WebSocket(url);\n\n      const onOpen = () => {\n        console.log('‚úÖ WebSocket connected to Tweets');\n        this.reconnectAttempts = 0;\n        this.ws = ws;\n\n        this.bp?.emit('tweets::connected');\n        resolve(this);\n      };\n\n      const onMessage = (event) => {\n        let data;\n        try {\n          data = JSON.parse(event.data);\n        } catch (err) {\n          console.error('‚ùå Failed to parse message:', event.data);\n          this.bp?.emit('tweets::error', { error: 'Invalid JSON', raw: event.data });\n          return;\n        }\n\n        // üîß Add support for custom actions later\n        console.log('üì¨ Message received from Tweets:', data);\n\n        let action = data.action;\n        let error = data.error;\n        if (error) {\n          console.error('‚ùå Error from Tweets:', error);\n          this.bp?.emit('tweets::error', { error });\n          return;\n        }\n\n        switch (action) {\n            case 'tweetsFeed':\n                console.log('Tweets feed received:', data.tweets);\n                this.bp?.emit('tweets::feed', data.tweets);\n                break;\n\n                case 'removedTweet':\n                  console.log('Tweet removed:', data.postId);\n                  this.bp?.emit('tweets::removed', data.postId);\n                  break;\n        }\n\n        // this.bp?.emit('tweets::message', { pondId: this.pondId, message: data });\n      };\n\n      const onClose = (event) => {\n        console.warn(`‚ö†Ô∏è WebSocket closed [${event.code}]: ${event.reason}`);\n\n        this.bp?.emit('tweets::disconnected', {\n          pondId: this.pondId,\n          code: event.code,\n          reason: event.reason,\n        });\n\n        if (!this.isIntentionallyClosed && this.reconnectAttempts < this.maxReconnectAttempts) {\n          const delay = Math.min(\n            200 * Math.pow(2, this.reconnectAttempts) * (1 + 0.1 * Math.random()),\n            this.maxBackoffDelay\n          );\n          console.log(`‚è≥ Reconnecting in ${Math.floor(delay)}ms...`);\n          setTimeout(() => {\n            this.reconnectAttempts++;\n            this.connect().catch(() => {});\n            this.bp?.emit('tweets::reconnecting', { attempt: this.reconnectAttempts });\n          }, delay);\n        } else {\n          if (this.reconnectAttempts >= this.maxReconnectAttempts) {\n            console.error('‚ùå Max reconnect attempts reached. Giving up.');\n            this.bp?.emit('tweets::reconnect_failed', { pondId: this.pondId });\n          }\n        }\n      };\n\n      const onError = (event) => {\n        console.error('‚ùå WebSocket error:', event);\n        this.bp?.emit('tweets::error', { error: 'WebSocket error', event });\n        ws.close(1000, 'Error occurred');\n        reject(new Error('WebSocket connection failed'));\n      };\n\n      // Attach handlers\n      ws.addEventListener('open', onOpen);\n      ws.addEventListener('message', onMessage);\n      ws.addEventListener('close', onClose);\n      ws.addEventListener('error', onError);\n\n      // Store methods for teardown\n      this._teardown = () => {\n        ws.removeEventListener('open', onOpen);\n        ws.removeEventListener('message', onMessage);\n        ws.removeEventListener('close', onClose);\n        ws.removeEventListener('error', onError);\n      };\n    });\n  }\n\n  disconnect() {\n    if (this.ws) {\n      this.isIntentionallyClosed = true;\n      this._teardown?.();\n      this.ws.close(1000, 'Normal closure');\n      this.bp?.emit('tweets::closed', { pondId: this.pondId });\n      this.ws = null;\n      console.log('üõë WebSocket disconnected from Tweets');\n    }\n  }\n\n  send(data) {\n    if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n      const msg = typeof data === 'string' ? data : JSON.stringify(data);\n      this.ws.send(msg);\n    } else {\n      console.warn('‚ö†Ô∏è Tried to send message but WebSocket is not open');\n    }\n  }\n\n\n  async fetchTweets (context) {\n    console.log('Requesting tweets feed from server...', context);\n     // sends a listActivePonds action message to the server\n    if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n      this.send({ action: 'fetchTweets', authorId: context });\n    } else {\n      console.warn('‚ö†Ô∏è Tried to get tweets feed but WebSocket is not open');\n    }\n\n  }\n\n  async postTweet ({ content }) {\n    console.log('Posting new tweet to server...');\n     // sends a listActivePonds action message to the server\n    if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n      this.send({ action: 'postTweet', content });\n    } else {\n      console.warn('‚ö†Ô∏è Tried to post tweet but WebSocket is not open');\n    }\n  }\n\n  async likeTweet ({ tweetId }) {\n    console.log('Liking tweet on server...');\n     // sends a listActivePonds action message to the server\n    if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n      this.send({ action: 'likeTweet', tweetId });\n    } else {\n      console.warn('‚ö†Ô∏è Tried to like tweet but WebSocket is not open');\n    }\n  }\n\n  async deleteTweet (tweetId) {\n    if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n      this.send({ action: 'deleteTweet', tweetId });\n    } else {\n      console.warn('‚ö†Ô∏è Tried to delete tweet but WebSocket is not open');\n    }\n  }\n\n\n}","/* Tweets.js - Marak Squires 2025 - BuddyPond */\nimport client from './lib/client.js';\nimport wsClient from './lib/wsclient.js';\nimport eventBind from './lib/eventBind.js';\nimport render from './lib/render.js';\nimport renderTweet from './lib/renderTweet.js';\n\nexport default class Tweets {\n  constructor(bp, options = {}) {\n    this.bp = bp;\n    this.icon = 'desktop/assets/images/icons/icon_tweets_64.png';\n    return this;\n  }\n\n  async init() {\n    this.html = await this.bp.load('/v5/apps/based/tweets/tweets.html');\n    await this.bp.load('/v5/apps/based/tweets/tweets.css');\n    return 'loaded tweets app';\n  }\n\n  async open(options = {}) {\n\n    if (!this.tweetsWindow) {\n      this.tweetsWindow = this.bp.apps.ui.windowManager.createWindow({\n        id: 'tweets',\n        title: 'Tweets',\n        icon: this.icon,\n        x: 250,\n        y: 75,\n        width: 800,\n        height: 400,\n        minWidth: 200,\n        minHeight: 200,\n        parent: $('#desktop')[0],\n        content: '',\n        resizable: true,\n        minimizable: true,\n        maximizable: true,\n        closable: true,\n        focusable: true,\n        maximized: false,\n        minimized: false,\n        onClose: () => {\n          if (this.wsClient) {\n            this.wsClient.disconnect();\n            this.wsClient = null;\n          }\n          // remove all event listeners\n          this.bp.off('tweets::connected', 'fetch-tweets-feed');\n          this.bp.off('tweets::feed', 'render-tweets-feed');\n          this.bp.off('tweets::removed', 'remove-tweet');\n          this.bp.off('tweets::error', 'tweets-error');\n          this.tweetsWindow = null\n          // remove tweets-reply-modal if exists\n          $('.tweets-reply-modal').remove();\n        }\n      });\n      this.tweetsWindow.loggedIn = true;\n    }\n\n    if (options.context === 'default' || !options.context || options.context === 'undefined') {\n      options.context = 'all';\n    }\n\n    let renderType = 'author';\n    if (options.type === 'post') {\n      renderType = 'post';\n    }\n\n    this.tweetsWindow.context = options.context || 'all';\n\n    if (!this.wsClient) {\n\n      this.wsClient = new wsClient({ bp: this.bp });\n      this.bp.on('tweets::connected', 'fetch-tweets-feed', (data) => {\n        console.log('Tweets WebSocket connected event received in Tweets app', data);\n        console.log('Tweets WebSocket connected');\n        this.wsClient.fetchTweets(this.tweetsWindow.context);\n      });\n\n      this.bp.on('tweets::feed', 'render-tweets-feed', (tweets) => {\n        console.log('Tweets feed event received in Tweets app', tweets);\n        if (this.tweetsWindow) {\n          this.render(tweets, this.tweetsWindow.context, 'author', this.tweetsWindow);\n        }\n      });\n\n      this.bp.on('tweets::removed', 'remove-tweet', (tweetId) => {\n        console.log('Tweet removed event received in Tweets app', tweetId);\n        if (this.tweetsWindow) {\n          // find the tweet by tweetId and remove\n          $(`[data-tweet=\"${tweetId}\"]`, this.tweetsWindow.content).remove();\n          console.log('remove the tweet', tweetId);\n        }\n      });\n\n      this.bp.on('tweets::error', 'tweets-error', (error) => {\n        console.error('Tweets error event received in Tweets app', error);\n        if (this.tweetsWindow) {\n          const errorDiv = $('.tweets-error', this.tweetsWindow.content);\n          if (errorDiv) {\n            errorDiv.html(`<div class=\"error\">Error: ${error.error}</div>`);\n            setTimeout(() => {\n              errorDiv.html('');\n            }, 5000);\n          }\n        }\n      });\n\n      console.log('Connecting to Tweets WebSocket...');\n      await this.wsClient.connect();\n\n    } else {\n      // fetch tweets feed for current context\n      this.wsClient.fetchTweets(this.tweetsWindow.context);\n    }\n\n\n    $(this.tweetsWindow.content).html(this.html);\n\n    this.eventBind(options.context, renderType, this.tweetsWindow);\n\n    return this.tweetsWindow;\n  }\n\n}\n\nTweets.prototype.client = client;\nTweets.prototype.eventBind = eventBind;\nTweets.prototype.render = render;\nTweets.prototype.renderTweet = renderTweet;","// eventBind.js\nexport default function eventBind(context, renderType, tweetsWindow) {\n  const MAX_CHARS = 280;\n  const holder = $('.tweets-holder', tweetsWindow.content);\n\n  // --- Circular character counter setup ---\n  function setupCharCounter(inputEl, container) {\n    if (container.find('.tweets-char-count').length === 0) {\n      container.prepend(`\n        <div class=\"tweets-char-count\" title=\"Character count\">\n          <svg width=\"40\" height=\"40\">\n            <circle class=\"bg\" r=\"18\" cx=\"20\" cy=\"20\" stroke=\"#eee\" stroke-width=\"3\" fill=\"none\"/>\n            <circle class=\"progress\" r=\"18\" cx=\"20\" cy=\"20\" stroke=\"#1DA1F2\" stroke-width=\"3\" fill=\"none\"\n              stroke-dasharray=\"${2 * Math.PI * 18}\" stroke-dashoffset=\"${2 * Math.PI * 18}\"\n              stroke-linecap=\"round\"/>\n          </svg>\n        </div>\n      `);\n    }\n\n    const circle = container.find('.progress');\n    const radius = 18;\n    const circumference = 2 * Math.PI * radius;\n\n    inputEl.on('input', () => {\n      const len = inputEl.val().length;\n      const percent = Math.min(len / MAX_CHARS, 1);\n      const offset = circumference - percent * circumference;\n\n      circle.css('stroke-dashoffset', offset);\n      circle.css('stroke', len > MAX_CHARS ? 'red' : '#1DA1F2');\n    });\n  }\n\n  // --- Helpers ---\n  async function handleCreatePost({ client, tweetsWindow, renderType }) {\n    const input = $('.tweets-input', tweetsWindow.content);\n    const errorEl = $('.tweets-error', tweetsWindow.content);\n    const content = input.val();\n\n    errorEl.text('');\n\n    if (content.length > MAX_CHARS) {\n      errorEl.text(`Post too long! Max ${MAX_CHARS} characters.`);\n      return;\n    }\n    this.wsClient.postTweet({\n      content\n    });\n    input.val('');\n    /*\n    try {\n      await client.apiRequest('/posts', 'POST', {\n        userId: buddypond.me,\n        content\n      });\n      input.val('');\n      await this.render(context, renderType, tweetsWindow);\n    } catch (err) {\n      console.error('Error creating post:', err);\n      errorEl.text(`Error: ${err.message}`);\n    }\n      */\n  }\n\n  async function createReplyPost({ client, tweetsWindow, renderType, tweetId, content }) {\n    if (!content) return;\n    if (content.length > MAX_CHARS) throw new Error(`Reply too long! Max ${MAX_CHARS} characters.`);\n\n    this.wsClient.send({ action: 'postReply', parentId: tweetId, content });\n\n    /*\n    await client.apiRequest(`/posts/${tweetId}/replies`, 'POST', {\n      userId: buddypond.me,\n      content\n    });\n    await this.render(context, renderType, tweetsWindow);\n    */\n  }\n\n  // --- Delegated events from .tweets-holder ---\n  holder.on('click', '.tweets-button', async (e) => {\n    e.preventDefault();\n    await handleCreatePost.call(this, { client: this.client, tweetsWindow, renderType });\n  });\n\n  holder.on('keypress', '.tweets-input', async (e) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      await handleCreatePost.call(this, { client: this.client, tweetsWindow, renderType });\n    }\n  });\n\n  holder.on('click', '.tweets-delete', async (e) => {\n    e.preventDefault();\n    if (!confirm('Are you sure you want to delete this tweet?')) return;\n\n    const tweetId = $(e.target).data('id');\n    //await this.client.apiRequest(`/posts/${tweetId}`, 'DELETE');\n    this.wsClient.deleteTweet(tweetId);\n    // remove the tweet from the DOM immediately\n    $(`[data-tweet=\"${tweetId}\"]`, tweetsWindow.content).remove();\n    //await this.render(buddypond.me, renderType, tweetsWindow);\n  });\n\n  holder.on('click', '.tweets-like', async (e) => {\n    e.preventDefault();\n    const tweetId = $(e.target).data('id');\n    this.wsClient.send({ action: 'likeTweet', tweetId });\n    //await this.client.apiRequest(`/posts/${tweetId}/likes`, 'POST', { userId: buddypond.me });\n    //await this.render(context, renderType, tweetsWindow);\n  });\n\n  /*\n  holder.on('click', '.tweets-retweet', async (e) => {\n    e.preventDefault();\n    const tweetId = $(e.target).data('id');\n    await this.client.apiRequest(`/posts/${tweetId}/repost`, 'POST', { userId: buddypond.me });\n    await this.render(buddypond.me, renderType, tweetsWindow);\n  });\n  */\n\n  holder.on('click', '.tweets-reply', async (e) => {\n    e.preventDefault();\n    const tweetId = $(e.target).data('id');\n\n    $('.tweets-reply-modal').remove();\n\n    //const tweetData = await this.client.apiRequest(`/posts/${tweetId}?reply_count=1`);\n    //const originalPostHtml = this.renderTweet(tweetData, tweetsWindow, { noToolbar: true, noRender: true });\n    // <div class=\"tweets-reply-modal-original\">${originalPostHtml}</div>\n\n    const modal = $(`\n      <div class=\"tweets-reply-modal\">\n        <div class=\"tweets-reply-modal-content desktop-section\">\n          <div class=\"tweets-reply-modal-header\">\n            <h3>Reply</h3>\n            <span class=\"tweets-reply-modal-close\">&times;</span>\n          </div>\n          <textarea class=\"tweets-reply-modal-input\" placeholder=\"Write your reply...\"></textarea>\n          <div class=\"tweets-error\"></div>\n          <div class=\"tweets-composer-controls\">\n            <div class=\"tweets-char-counter\"></div>\n            <button class=\"tweets-reply-modal-submit\">Reply</button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(modal);\n    const input = modal.find('.tweets-reply-modal-input');\n    input.focus();\n\n    // setup counter for reply\n    setupCharCounter(input, modal.find('.tweets-char-counter'));\n\n    modal.find('.tweets-reply-modal-close').on('click', () => modal.remove());\n\n    async function submitReply() {\n      const replyContent = input.val().trim();\n      if (!replyContent) return;\n\n      const errorEl = modal.find('.tweets-error');\n      errorEl.text('');\n\n      try {\n        await createReplyPost.call(this, {\n          client: this.client,\n          tweetsWindow,\n          renderType,\n          tweetId,\n          content: replyContent\n        });\n        modal.remove();\n      } catch (err) {\n        errorEl.text(`Error: ${err.message}`);\n      }\n    }\n\n    modal.find('.tweets-reply-modal-submit').on('click', submitReply.bind(this));\n    input.on('keypress', (e) => {\n      if (e.key === 'Enter' && !e.shiftKey) {\n        e.preventDefault();\n        submitReply.call(this);\n      }\n    });\n  });\n\n  // --- Setup main composer counter once ---\n  setupCharCounter($('.tweets-input', tweetsWindow.content), $('.tweets-composer-controls', tweetsWindow.content));\n}\n","export default async function render(tweets, context, type = 'author', tweetsWindow) {\n  if (this.bp.me === 'Guest' || !this.bp.me) {\n    $('.loggedIn', this.tweetsWindow.content).hide();\n    $('.loggedOut', this.tweetsWindow.content).show();\n  } else {\n    $('.loggedIn', this.tweetsWindow.content).show();\n    $('.loggedOut', this.tweetsWindow.content).hide();\n  }\n  /*\n  let tweets;\n\n  if (type === 'post' && context) {\n    // fetch single tweet with replies from the backend\n    tweets = await this.client.apiRequest(`/posts/${context}`);\n    tweets = [tweets]; // wrap in array for uniform processing\n  } else {\n    // fetch tweets from the backend\n    if (context !== 'all') {\n      // clear all tweets\n      // $('.tweets-timeline', tweetsWindow.content).empty();\n      tweets = await this.client.apiRequest(`/feed/${context}`);\n    } else {\n      tweets = await this.client.apiRequest('/feed');\n    }\n\n  }\n  */\n\n  // console.log('Fetched tweets:', tweets);\n\n  const tweetList = $('.tweets-timeline', tweetsWindow.content);\n  // tweetList.empty();\n  tweets.forEach(tweet => {\n    tweetList.prepend(this.renderTweet(tweet, tweetsWindow))\n  })\n\n}\n","export default function renderTweet(tweet, tweetsWindow, options = {}) {\n  let showReplyButton = true;\n  let replyButton = ``;\n  let deleteButton = ``;\n  let likeButton = `<a href=\"#\" class=\"tweets-like\" data-id=\"${tweet.id}\">Like (${tweet.like_count || 0})</a>`;\n\n  // TODO: we need to check if the tweet.parent_id exists in the DOM, if so, we need to nest this tweet under that parent as a reply\n\n  // Check if tweet already exists in DOM\n  let existingTweet = $(`[data-tweet=\"${tweet.id}\"]`, tweetsWindow.content);\n  if (options.noRender !== true && existingTweet.length > 0) {\n    // --- Differential update ---\n    existingTweet.attr('data-likes', tweet.like_count || 0);\n    existingTweet.attr('data-replies', tweet.reply_count || 0);\n\n    $('.tweets-like', existingTweet).html(`Like (${tweet.like_count || 0})`);\n    $('.tweets-reply', existingTweet).html(`Reply (${tweet.reply_count || 0})`);\n\n    // update content in case it changed (edits)\n    $('.tweets-content', existingTweet).text(tweet.content);\n    $('.tweets-meta', existingTweet).html(new Date(tweet.ctime).toLocaleString());\n\n    // --- Handle replies differential update ---\n    if (options.noRender !== true && tweet.replies && tweet.replies.length > 0) {\n      let repliesContainer = existingTweet.children('.tweets-replies');\n      if (repliesContainer.length === 0) {\n        repliesContainer = $('<div class=\"tweets-replies\"></div>');\n        existingTweet.append(repliesContainer);\n      }\n\n      // Render replies\n      const seenReplies = new Set();\n      tweet.replies.forEach(reply => {\n        seenReplies.add(reply.id);\n        const replyHtml = this.renderTweet(reply, tweetsWindow, options);\n        if (replyHtml) {\n          repliesContainer.append(replyHtml);\n        }\n      });\n\n      // Remove replies that no longer exist\n      repliesContainer.children('[data-tweet]').each((_, el) => {\n        const replyId = $(el).attr('data-tweet');\n        if (!seenReplies.has(replyId)) {\n          $(el).remove();\n        }\n      });\n    }\n\n    return ''; // stop here, already updated DOM\n  }\n\n  // --- New Tweet ---\n  if (!tweet.parent_id) {\n    replyButton = `<a href=\"#\" class=\"tweets-reply\" data-id=\"${tweet.id}\">Reply (${tweet.reply_count || 0})</a>`;\n  }\n\n  if (tweet.author === this.bp.me || this.bp.me === 'Marak') {\n    deleteButton = `<a href=\"#\" class=\"tweets-delete\" data-id=\"${tweet.id}\">Delete</a>`;\n  }\n\n  if (options.noToolbar) {\n    replyButton = ``;\n    deleteButton = ``;\n    likeButton = ``;\n  }\n\n  let $tweet = $(`\n  <div class=\"tweets-post desktop-section\" data-tweet=\"${tweet.id}\" data-likes=\"${tweet.like_count || 0}\" data-replies=\"${tweet.reply_count || 0}\">\n    <div class=\"tweets-author\">\n      <a href=\"#\" class=\"open-app\" data-app=\"tweets\" data-context=\"${tweet.author}\">\n        @${tweet.author}\n      </a>\n    </div>\n    <div class=\"tweets-content\"></div>\n    <div class=\"tweets-meta\"></div>\n    <div class=\"tweets-toolbar\">\n      ${likeButton}\n      ${replyButton}\n      ${deleteButton}\n    </div>\n  </div>\n`);\n\n  // safely insert user content\n  $('.tweets-content', $tweet).text(tweet.content);\n  $('.tweets-meta', $tweet).text(new Date(tweet.ctime).toLocaleString());\n\n  // append replies if any\n  if (options.noRender !== true && tweet.replies && tweet.replies.length > 0) {\n    let $replies = $('<div class=\"tweets-replies\"></div>');\n    tweet.replies.forEach(reply => {\n      $replies.append(this.renderTweet(reply, tweetsWindow, options));\n    });\n    $tweet.append($replies);\n  }\n\n  return $tweet;\n\n}\n"],"names":["client","async","uri","method","data","options","headers","Accept","buddypond","me","qtokenid","body","JSON","stringify","url","endpoint","console","log","response","fetch","ok","errorText","text","Error","statusText","json","error","TweetsWebSocketClient","constructor","bp","this","tweetsWsEndpoint","ws","reconnectAttempts","maxReconnectAttempts","maxBackoffDelay","isIntentionallyClosed","connect","Promise","resolve","reject","WebSocket","onOpen","emit","onMessage","event","parse","err","raw","action","tweets","postId","onClose","warn","code","reason","pondId","delay","Math","min","pow","random","floor","setTimeout","catch","attempt","onError","close","addEventListener","_teardown","removeEventListener","disconnect","send","readyState","OPEN","msg","fetchTweets","context","authorId","postTweet","content","likeTweet","tweetId","deleteTweet","Tweets","icon","init","html","load","open","tweetsWindow","apps","ui","windowManager","createWindow","id","title","x","y","width","height","minWidth","minHeight","parent","$","resizable","minimizable","maximizable","closable","focusable","maximized","minimized","wsClient","off","remove","loggedIn","renderType","type","on","render","errorDiv","eventBind","prototype","MAX_CHARS","holder","setupCharCounter","inputEl","container","find","length","prepend","PI","circle","circumference","len","val","percent","offset","css","handleCreatePost","input","errorEl","createReplyPost","parentId","e","preventDefault","call","key","shiftKey","confirm","target","modal","append","submitReply","replyContent","trim","message","focus","bind","show","hide","tweetList","forEach","tweet","renderTweet","replyButton","deleteButton","likeButton","like_count","existingTweet","noRender","attr","reply_count","Date","ctime","toLocaleString","replies","repliesContainer","children","seenReplies","Set","reply","add","replyHtml","each","_","el","replyId","has","parent_id","author","noToolbar","$tweet","$replies"],"mappings":"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"}